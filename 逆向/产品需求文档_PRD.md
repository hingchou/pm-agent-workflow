# **æ•ˆæœå½’å›  Agent - äº§å“éœ€æ±‚æ–‡æ¡£ (PRD)**

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv2.0 (æ”¹è¿›ç‰ˆ)
> **é€‚ç”¨èŒƒå›´**ï¼šTikTok AI è¿è¥ç³»ç»Ÿ - æ•ˆæœå½’å› æ¨¡å—
> **ç›®æ ‡è¯»è€…**ï¼šåç«¯å¼€å‘å›¢é˜Ÿã€AI å·¥ç¨‹å¸ˆã€æ•°æ®å·¥ç¨‹å¸ˆ
> **æ›´æ–°æ—¥æœŸ**ï¼š2026-02-07
> **æ–‡æ¡£ä½œè€…**ï¼šArnold

## ğŸ“ ç‰ˆæœ¬æ›´æ–°è¯´æ˜ (v2.0)

åŸºäº v1.0 å®æ–½ç»“æœçš„è¯„ä¼°åé¦ˆï¼Œæœ¬ç‰ˆæœ¬è¿›è¡Œäº†ä»¥ä¸‹å…³é”®æ”¹è¿›ï¼š

1. **âœ… å¢åŠ åŠŸèƒ½ä¼˜å…ˆçº§å®šä¹‰**
   - æ–°å¢ç¬¬ 2.5 èŠ‚ï¼šåŠŸèƒ½ä¼˜å…ˆçº§ä¸ MVP å®šä¹‰
   - æ˜ç¡® P0/P1/P2 ä¼˜å…ˆçº§ï¼Œå®šä¹‰ MVP èŒƒå›´
   - æä¾›åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

2. **âœ… ç®€åŒ–æ¶æ„è®¾è®¡**
   - Agent èŠ‚ç‚¹ä» 10 ä¸ªç®€åŒ–ä¸º 5 ä¸ªï¼ˆå‡å°‘ 50%ï¼‰
   - Tools ä» 8 ä¸ªç®€åŒ–ä¸º 5 ä¸ªï¼ˆå‡å°‘ 37.5%ï¼‰
   - æ•°æ®åº“è¡¨ä¿æŒ 4 ä¸ªï¼ˆå·²ä¼˜åŒ–ï¼‰

3. **âœ… æ˜ç¡® MVP èŒƒå›´**
   - å®šä¹‰ MVP å¿…é¡»å®ç°çš„åŠŸèƒ½ï¼ˆP0ï¼‰
   - åŒºåˆ†é‡è¦ä½†éå¿…é¡»çš„åŠŸèƒ½ï¼ˆP1ï¼‰
   - æ ‡æ³¨å¯é€‰åŠŸèƒ½ï¼ˆP2ï¼‰

**æ”¹è¿›ç›®æ ‡**ï¼š
- é™ä½å®æ–½å¤æ‚åº¦ï¼Œç¼©çŸ­å¼€å‘å‘¨æœŸ
- æé«˜å®æ–½å¯æ§æ€§ï¼Œç¡®ä¿æ ¸å¿ƒåŠŸèƒ½ä¼˜å…ˆäº¤ä»˜
- ä¿æŒæŠ€æœ¯è´¨é‡ï¼Œä¸é™ä½ç³»ç»Ÿå¯æ‰©å±•æ€§

---

## ğŸ“‹ ç›®å½•

1. [æ–‡æ¡£æ¦‚è¿°](#ä¸€æ–‡æ¡£æ¦‚è¿°)
2. [äº§å“æ¦‚è¿°](#äºŒäº§å“æ¦‚è¿°)
   - **2.5 åŠŸèƒ½ä¼˜å…ˆçº§ä¸ MVP å®šä¹‰** â­ æ–°å¢
3. [Agent æ¶æ„è®¾è®¡](#ä¸‰agent-æ¶æ„è®¾è®¡) â­ ç®€åŒ–
4. [æ•°æ®è¾“å…¥è§„èŒƒ](#å››æ•°æ®è¾“å…¥è§„èŒƒ)
5. [Tools & Skills è®¾è®¡](#äº”tools--skills-è®¾è®¡) â­ ç®€åŒ–
6. [Agent å†…éƒ¨å¤„ç†é€»è¾‘](#å…­agent-å†…éƒ¨å¤„ç†é€»è¾‘)
7. [Prompt å·¥ç¨‹è§„èŒƒ](#ä¸ƒprompt-å·¥ç¨‹è§„èŒƒ)
8. [è¾“å‡ºç»“æœè§„èŒƒ](#å…«è¾“å‡ºç»“æœè§„èŒƒ)
9. [æŠ€æœ¯å®ç°è¦æ±‚](#ä¹æŠ€æœ¯å®ç°è¦æ±‚)
10. [æµ‹è¯•éªŒæ”¶æ ‡å‡†](#åæµ‹è¯•éªŒæ”¶æ ‡å‡†)

---

## ä¸€ã€æ–‡æ¡£æ¦‚è¿°

### 1.1 æ–‡æ¡£ç›®çš„

æœ¬æ–‡æ¡£è¯¦ç»†å®šä¹‰**æ•ˆæœå½’å›  Agent** çš„äº§å“éœ€æ±‚è§„æ ¼ï¼Œç¡®ä¿æŠ€æœ¯å›¢é˜Ÿèƒ½å¤Ÿï¼š

1. **å‡†ç¡®ç†è§£ä¸šåŠ¡é€»è¾‘**ï¼šä¸‰å±‚å½’å› åˆ†ææ¡†æ¶ï¼ˆè¶‹åŠ¿/ç”¨æˆ·/æ‰§è¡Œå› ç´ ï¼‰çš„è®¡ç®—è§„åˆ™
2. **æ­£ç¡®å®ç°æ•°æ®æµè½¬**ï¼šä» Tikfly API æŠ“å–åˆ°å½’å› ç»“æœè¾“å‡ºçš„å®Œæ•´æ•°æ®é“¾è·¯
3. **ç²¾ç¡®é…ç½® LLM Prompt**ï¼šå½’å› åˆ†æçš„ System Prompt ä¸ User Prompt æ¨¡æ¿
4. **æ¸…æ™°æŒæ¡æ¥å£è§„èŒƒ**ï¼šæ•°æ®åº“è¡¨ç»“æ„ã€API ç«¯ç‚¹ã€é”™è¯¯å¤„ç†æœºåˆ¶

### 1.2 æ–‡æ¡£ç»“æ„è¯´æ˜

- **å¿…é¡»åŒ…å«**ï¼šAgent èŠ‚ç‚¹é€»è¾‘ã€æ•°æ®ç»“æ„å®šä¹‰ã€Prompt å®Œæ•´ç¤ºä¾‹ã€æ•°æ®åº“ Schema
- **é‡ç‚¹å…³æ³¨**ï¼šå½’å› ç®—æ³•å®ç°ç»†èŠ‚ã€å­¦ä¹ ä¿¡å·ç”Ÿæˆè§„åˆ™ã€Tikfly API é›†æˆæ–¹æ¡ˆ
- **ä¸åŒ…å«**ï¼šé€šç”¨çš„ç³»ç»Ÿç›‘æ§ã€æ—¥å¿—è§„èŒƒï¼ˆç”±æŠ€æœ¯å›¢é˜ŸåŸºç¡€è®¾æ–½è´Ÿè´£ï¼‰

### 1.3 å…³é”®æœ¯è¯­å®šä¹‰

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| **å½’å› åˆ†æ** | å°†å†…å®¹æ•ˆæœåˆ†è§£ä¸ºè¶‹åŠ¿/ç”¨æˆ·/æ‰§è¡Œä¸‰å› ç´ ï¼Œé‡åŒ–å„å› ç´ è´¡çŒ®åº¦çš„è¿‡ç¨‹ |
| **ç›¸å¯¹è¯„ä¼°** | åŸºäºç”¨æˆ·å†å²åŸºå‡†ï¼ˆè€Œéç»å¯¹é˜ˆå€¼ï¼‰è¿›è¡Œæ•ˆæœè¯„åˆ†çš„æ–¹æ³• |
| **å­¦ä¹ ä¿¡å·** | å½’å› ç»“æœäº§ç”Ÿçš„ç”¨äºä¼˜åŒ–æ¨èç³»ç»Ÿçš„å‚æ•°è°ƒæ•´æŒ‡ä»¤ |
| **æ‰§è¡Œåˆ°ä½åº¦** | å®é™…æ‰§è¡Œä¸æ¨èç­–ç•¥çš„ç¬¦åˆç¨‹åº¦ï¼ˆ0-100 åˆ†ï¼‰ |
| **æ•ˆæœç­‰çº§** | ç»¼åˆè¯„åˆ†æ˜ å°„çš„äº”çº§åˆ†ç±»ï¼šviral/excellent/good/average/poor |

---

## äºŒã€äº§å“æ¦‚è¿°

### 2.1 äº§å“/åŠŸèƒ½åç§°

**æ•ˆæœå½’å›  Agent (Attribution Agent)**

### 2.2 äº§å“å®šä½

> **TikTok AI è¿è¥ç³»ç»Ÿçš„"æ™ºæ…§å¤§è„‘"**ï¼Œé€šè¿‡ç§‘å­¦çš„ä¸‰å±‚å½’å› åˆ†æï¼ˆè¶‹åŠ¿å› ç´  40% + ç”¨æˆ·å› ç´  25% + æ‰§è¡Œå› ç´  35%ï¼‰ï¼Œå°†å†…å®¹æ•ˆæœè½¬åŒ–ä¸ºå¯å­¦ä¹ çŸ¥è¯†ï¼Œé©±åŠ¨æ¨èç³»ç»Ÿçš„æŒç»­è¿›åŒ–ã€‚

### 2.3 æ ¸å¿ƒä»·å€¼

| ä»·å€¼ç‚¹ | æè¿° |
|--------|------|
| **ç”¨æˆ·ä»·å€¼** | åˆ›ä½œè€…è·å¾—ç²¾å‡†çš„æ•ˆæœè§£è¯»å’Œå¯æ“ä½œæ”¹è¿›å»ºè®®ï¼Œå†…å®¹æ•ˆæœæå‡ 15-30% |
| **ä¸šåŠ¡ä»·å€¼** | æ„å»ºç‹¬æœ‰çš„"è¶‹åŠ¿+ç”¨æˆ·+æ‰§è¡Œ=æ•ˆæœ"çŸ¥è¯†å›¾è°±ï¼Œå½¢æˆæ ¸å¿ƒç«äº‰å£å’ |
| **æŠ€æœ¯ä»·å€¼** | å®ç°æ¨èç®—æ³•è‡ªæˆ‘ä¼˜åŒ–ï¼Œå½’å› å‡†ç¡®ç‡ > 85%ï¼Œå­¦ä¹ åé¦ˆæœ‰æ•ˆæ€§ > 90% |

### 2.4 äº§å“è¾¹ç•Œ

**åŒ…å«èŒƒå›´ï¼š**
- 72 å°æ—¶æ•ˆæœæ•°æ®å½’å› åˆ†æ
- ä¸‰å› ç´ å®šé‡è¯„åˆ†è®¡ç®—
- LLM é©±åŠ¨çš„æ´å¯Ÿç”Ÿæˆ
- å­¦ä¹ ä¿¡å·è‡ªåŠ¨æå–ä¸æ³¨å…¥
- å¼‚å¸¸æ£€æµ‹ä¸äººå·¥å®¡æ ¸è§¦å‘

**ä¸åŒ…å«èŒƒå›´ï¼š**
- å®æ—¶æµé‡é¢„è­¦ï¼ˆç”±ç›‘æ§ç³»ç»Ÿè´Ÿè´£ï¼‰
- å†…å®¹æ¨èç”Ÿæˆï¼ˆç”±æ¨è Agent è´Ÿè´£ï¼‰
- ç›´æ¥çš„æ•°æ®å¯è§†åŒ–ï¼ˆç”±å‰ç«¯ BI æ¨¡å—è´Ÿè´£ï¼‰
- Tikfly API åº•å±‚å®ç°ï¼ˆä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡ï¼‰

---

### 2.5 åŠŸèƒ½ä¼˜å…ˆçº§ä¸ MVP å®šä¹‰ â­ æ–°å¢

#### 2.5.1 ä¼˜å…ˆçº§å®šä¹‰æ ‡å‡†

| ä¼˜å…ˆçº§ | æ ‡è¯† | å®šä¹‰ | å®æ–½è¦æ±‚ |
|--------|------|------|----------|
| **P0** | ğŸ”´ å¿…é¡»å®ç° | MVP æ ¸å¿ƒåŠŸèƒ½ï¼Œç¼ºå¤±åˆ™ç³»ç»Ÿæ— æ³•è¿è¡Œ | Phase 1 å¿…é¡»å®Œæˆ |
| **P1** | ğŸŸ¡ é‡è¦åŠŸèƒ½ | æå‡ç”¨æˆ·ä½“éªŒå’Œç³»ç»Ÿå®Œæ•´æ€§çš„åŠŸèƒ½ | Phase 2 å®Œæˆ |
| **P2** | ğŸŸ¢ å¯é€‰åŠŸèƒ½ | ä¼˜åŒ–æ€§èƒ½å’Œæ‰©å±•èƒ½åŠ›çš„åŠŸèƒ½ | Phase 3 æˆ–åç»­è¿­ä»£ |

#### 2.5.2 MVP èŒƒå›´å®šä¹‰ (Phase 1)

**ç›®æ ‡**ï¼šå®ç°æ ¸å¿ƒå½’å› åˆ†æèƒ½åŠ›ï¼ŒéªŒè¯ä¸šåŠ¡ä»·å€¼

**P0 åŠŸèƒ½æ¸…å•** ğŸ”´ï¼š

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½æè¿° | éªŒæ”¶æ ‡å‡† |
|---------|---------|---------|
| **æ ¸å¿ƒç®—æ³•** | ä¸‰å› ç´ å½’å› ç®—æ³•ï¼ˆ40/25/35 æƒé‡ï¼‰ | æƒé‡å®ˆæ’ï¼Œè¯„åˆ†æœ‰ç•Œ |
| **ç›¸å¯¹è¯„åˆ†** | Z-score æ ‡å‡†åŒ–è¯„åˆ†æ¨¡å‹ | é›¶å€¼ä¿æŠ¤ï¼Œè¾¹ç•ŒéªŒè¯ |
| **API å®¢æˆ·ç«¯** | Tikfly API è°ƒç”¨ï¼ˆè§†é¢‘è¯¦æƒ…ï¼‰ | é‡è¯•æœºåˆ¶ï¼Œé™æµæ§åˆ¶ |
| **LLM é›†æˆ** | KIMI API è°ƒç”¨ï¼ˆæ´å¯Ÿç”Ÿæˆï¼‰ | JSON è¾“å‡ºï¼ŒSchema éªŒè¯ |
| **å­¦ä¹ ä¿¡å·** | EMA æ›´æ–°ç®—æ³• | åå¥½ç³»æ•°æ›´æ–° |
| **API ç«¯ç‚¹** | POST /analyze, GET /{id} | è¯·æ±‚éªŒè¯ï¼Œé”™è¯¯å¤„ç† |
| **å•å…ƒæµ‹è¯•** | æ ¸å¿ƒæ¨¡å—æµ‹è¯•è¦†ç›– > 90% | 24+ æµ‹è¯•ç”¨ä¾‹é€šè¿‡ |

**MVP ä¸åŒ…å«** âŒï¼š
- æ•°æ®åº“æŒä¹…åŒ–ï¼ˆä½¿ç”¨å†…å­˜å­˜å‚¨ï¼‰
- Redis ç¼“å­˜
- Celery å¼‚æ­¥ä»»åŠ¡
- æ‰¹é‡å½’å› åˆ†æ
- å®Œæ•´çš„ 10 ä¸ª Agent èŠ‚ç‚¹
- é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•

**MVP äº¤ä»˜æ ‡å‡†**ï¼š
- âœ… æ ¸å¿ƒå½’å› ç®—æ³•å¯è¿è¡Œ
- âœ… API å¯æ¥å—è¯·æ±‚å¹¶è¿”å›ç»“æœ
- âœ… å•å…ƒæµ‹è¯• 100% é€šè¿‡
- âœ… ä»£ç è´¨é‡è¾¾åˆ°ç”Ÿäº§çº§åˆ«

---

#### 2.5.3 Phase 2 åŠŸèƒ½è§„åˆ’ (P1)

**ç›®æ ‡**ï¼šå®Œå–„ç³»ç»ŸåŠŸèƒ½ï¼Œå®ç°ç”Ÿäº§å°±ç»ª

**P1 åŠŸèƒ½æ¸…å•** ğŸŸ¡ï¼š

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½æè¿° | ä¾èµ– |
|---------|---------|------|
| **æ•°æ®åº“é›†æˆ** | PostgreSQL + SQLAlchemy | MVP å®Œæˆ |
| **ç¼“å­˜å±‚** | Redis ç¼“å­˜ï¼ˆTTL=24hï¼‰ | æ•°æ®åº“é›†æˆ |
| **å®Œæ•´å½’å› æµç¨‹** | 5 ä¸ª Agent èŠ‚ç‚¹é›†æˆ | æ•°æ®åº“é›†æˆ |
| **åŸºå‡†è®¡ç®—** | 30 å¤©æ»šåŠ¨åŸºå‡† | æ•°æ®åº“é›†æˆ |
| **ç»“æœæŒä¹…åŒ–** | å½’å› ç»“æœå†™å…¥æ•°æ®åº“ | æ•°æ®åº“é›†æˆ |
| **é›†æˆæµ‹è¯•** | æ¨¡å—é—´é›†æˆéªŒè¯ | å®Œæ•´æµç¨‹ |
| **é”™è¯¯å¤„ç†** | å®Œæ•´çš„é”™è¯¯ç å’Œå¤„ç†é€»è¾‘ | - |

**Phase 2 äº¤ä»˜æ ‡å‡†**ï¼š
- âœ… æ•°æ®åº“é›†æˆå®Œæˆ
- âœ… å®Œæ•´å½’å› æµç¨‹å¯è¿è¡Œ
- âœ… é›†æˆæµ‹è¯•é€šè¿‡
- âœ… ç³»ç»Ÿå¯éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ

---

#### 2.5.4 Phase 3 åŠŸèƒ½è§„åˆ’ (P2)

**ç›®æ ‡**ï¼šä¼˜åŒ–æ€§èƒ½ï¼Œå¢å¼ºå¯æ‰©å±•æ€§

**P2 åŠŸèƒ½æ¸…å•** ğŸŸ¢ï¼š

| åŠŸèƒ½æ¨¡å— | åŠŸèƒ½æè¿° | é¢„æœŸæ”¶ç›Š |
|---------|---------|---------|
| **å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—** | Celery + Redis | æå‡ååé‡ 5x |
| **æ‰¹é‡å½’å› ** | æ‰¹é‡åˆ†æ API | é™ä½ API è°ƒç”¨æˆæœ¬ |
| **æ€§èƒ½ä¼˜åŒ–** | æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ã€è¿æ¥æ±  | é™ä½ P95 å»¶è¿Ÿ 50% |
| **ç›‘æ§å‘Šè­¦** | Prometheus + Grafana | æå‡å¯è§‚æµ‹æ€§ |
| **ç«¯åˆ°ç«¯æµ‹è¯•** | å®Œæ•´æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯• | æå‡è´¨é‡ä¿éšœ |
| **API ç‰ˆæœ¬ç®¡ç†** | v1/v2 ç‰ˆæœ¬å…±å­˜ | æ”¯æŒå¹³æ»‘å‡çº§ |

**Phase 3 äº¤ä»˜æ ‡å‡†**ï¼š
- âœ… æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ï¼ˆP95 < 30sï¼‰
- âœ… ç›‘æ§å‘Šè­¦å®Œå–„
- âœ… ç³»ç»Ÿå¯éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

#### 2.5.5 å®æ–½æ—¶é—´çº¿ï¼ˆå‚è€ƒï¼‰

```
Phase 1 (MVP)          Phase 2 (å®Œå–„)        Phase 3 (ä¼˜åŒ–)
â”œâ”€ Week 1-2           â”œâ”€ Week 3-4          â”œâ”€ Week 5-6
â”‚  æ ¸å¿ƒç®—æ³•            â”‚  æ•°æ®åº“é›†æˆ          â”‚  å¼‚æ­¥ä»»åŠ¡
â”‚  API å®¢æˆ·ç«¯          â”‚  ç¼“å­˜å±‚              â”‚  æ€§èƒ½ä¼˜åŒ–
â”‚  LLM é›†æˆ            â”‚  å®Œæ•´æµç¨‹            â”‚  ç›‘æ§å‘Šè­¦
â”‚  å•å…ƒæµ‹è¯•            â”‚  é›†æˆæµ‹è¯•            â”‚  ç«¯åˆ°ç«¯æµ‹è¯•
â””â”€ MVP äº¤ä»˜           â””â”€ æµ‹è¯•ç¯å¢ƒéƒ¨ç½²       â””â”€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
```

**æ³¨æ„**ï¼šæ—¶é—´çº¿ä»…ä¾›å‚è€ƒï¼Œå®é™…è¿›åº¦æ ¹æ®å›¢é˜Ÿèµ„æºå’Œä¼˜å…ˆçº§è°ƒæ•´ã€‚

---

## ä¸‰ã€Agent æ¶æ„è®¾è®¡ â­ ç®€åŒ–

> **v2.0 æ”¹è¿›**ï¼šAgent èŠ‚ç‚¹ä» 10 ä¸ªç®€åŒ–ä¸º 5 ä¸ªï¼Œé™ä½ç³»ç»Ÿå¤æ‚åº¦ï¼Œæå‡å¯ç»´æŠ¤æ€§ã€‚

### 3.1 Agent æ•´ä½“æ¶æ„å›¾ï¼ˆç®€åŒ–ç‰ˆï¼‰

```mermaid
graph TB
    A[è§¦å‘å™¨] --> B[N1 æ•°æ®å¤„ç†èŠ‚ç‚¹]
    B --> C[N2 å½’å› åˆ†æèŠ‚ç‚¹]
    C --> D[N3 æ´å¯Ÿç”ŸæˆèŠ‚ç‚¹]
    D --> E[N4 å­¦ä¹ ä¿¡å·èŠ‚ç‚¹]
    E --> F[N5 ç»“æœè¾“å‡ºèŠ‚ç‚¹]

    B -.->|API è°ƒç”¨| G[Tikfly API]
    B -.->|æŸ¥è¯¢| H[(æ•°æ®åº“)]
    E -.->|æ›´æ–°| I[(ä¸ªæ€§åŒ–å‚æ•°)]
    F -.->|å†™å…¥| J[(å½’å› ç»“æœ)]
```

**ç®€åŒ–è¯´æ˜**ï¼š
- **N1 æ•°æ®å¤„ç†èŠ‚ç‚¹** = åŸ N001ï¼ˆæ•°æ®é‡‡é›†ï¼‰+ N002ï¼ˆåŸºå‡†è®¡ç®—ï¼‰+ N003ï¼ˆæ•ˆæœè¯„ä¼°ï¼‰
- **N2 å½’å› åˆ†æèŠ‚ç‚¹** = åŸ N004ï¼ˆè¶‹åŠ¿å½’å› ï¼‰+ N005ï¼ˆç”¨æˆ·å½’å› ï¼‰+ N006ï¼ˆæ‰§è¡Œå½’å› ï¼‰
- **N3 æ´å¯Ÿç”ŸæˆèŠ‚ç‚¹** = åŸ N007ï¼ˆLLM æ´å¯Ÿç”Ÿæˆï¼‰
- **N4 å­¦ä¹ ä¿¡å·èŠ‚ç‚¹** = åŸ N008ï¼ˆå­¦ä¹ ä¿¡å·æå–ï¼‰
- **N5 ç»“æœè¾“å‡ºèŠ‚ç‚¹** = åŸ N009ï¼ˆç»“æœæŒä¹…åŒ–ï¼‰+ N010ï¼ˆè¾“å‡ºç”Ÿæˆï¼‰

---

### 3.2 Agent èŠ‚ç‚¹è¯´æ˜ï¼ˆç®€åŒ–ç‰ˆï¼‰

| èŠ‚ç‚¹ID | èŠ‚ç‚¹åç§° | åŠŸèƒ½æè¿° | ä¼˜å…ˆçº§ | è¾“å…¥ | è¾“å‡º | ä¾èµ– |
|--------|----------|----------|--------|------|------|------|
| **N1** ğŸ”´ | æ•°æ®å¤„ç†èŠ‚ç‚¹ | **æ•°æ®é‡‡é›†**ï¼šä» Tikfly API æŠ“å–è§†é¢‘ 72h æ•ˆæœæ•°æ®<br>**åŸºå‡†è®¡ç®—**ï¼šè®¡ç®—ç”¨æˆ· 30 å¤©æ»šåŠ¨åŸºå‡†æŒ‡æ ‡<br>**æ•ˆæœè¯„ä¼°**ï¼šè®¡ç®—ç›¸å¯¹è¡¨ç°è¯„åˆ†ï¼Œæ˜ å°„æ•ˆæœç­‰çº§ | P0 | `{video_id, account_id}` | `{performance_data, baseline_metrics, effect_evaluation}` | Tikfly API, PostgreSQL |
| **N2** ğŸ”´ | å½’å› åˆ†æèŠ‚ç‚¹ | **è¶‹åŠ¿å½’å› **ï¼šåˆ†æè¶‹åŠ¿é¢„æµ‹å‡†ç¡®æ€§ã€å…¥åœºæ—¶æœºã€è¶‹åŠ¿è´¨é‡<br>**ç”¨æˆ·å½’å› **ï¼šåˆ†æè´¦å·èƒ½åŠ›åŒ¹é…åº¦ã€èµ›é“ç›¸å…³æ€§ã€å†å²ç¨³å®šæ€§<br>**æ‰§è¡Œå½’å› **ï¼šåˆ†æå†…å®¹è´¨é‡ã€è§’åº¦æœ‰æ•ˆæ€§ã€å‘å¸ƒæ—¶é—´åˆè§„æ€§ | P0 | `{effect_evaluation, performance_data, baseline_metrics}` | `{trend_attribution, user_attribution, execution_attribution}` | å½’å› ç®—æ³• |
| **N3** ğŸ”´ | æ´å¯Ÿç”ŸæˆèŠ‚ç‚¹ | è°ƒç”¨ LLM (KIMI/GPT-4o) ç”Ÿæˆ 3 æ¡å…³é”®æ´å¯Ÿ/å› ç´  | P0 | `{effect_evaluation, attributions}` | `{insights, success_factors, improvement_suggestions}` | KIMI API |
| **N4** ğŸ”´ | å­¦ä¹ ä¿¡å·èŠ‚ç‚¹ | æå–è¶‹åŠ¿åå¥½/è§’åº¦åå¥½/èƒ½åŠ›è¾¹ç•Œè°ƒæ•´ä¿¡å·ï¼Œä½¿ç”¨ EMA æ›´æ–° | P0 | `{effect_evaluation, attributions}` | `{learning_signals}` | å­¦ä¹ è§„åˆ™å¼•æ“ |
| **N5** ğŸŸ¡ | ç»“æœè¾“å‡ºèŠ‚ç‚¹ | **ç»“æœæŒä¹…åŒ–**ï¼šå°†å½’å› ç»“æœå†™å…¥æ•°æ®åº“<br>**è¾“å‡ºç”Ÿæˆ**ï¼šç”Ÿæˆåˆ›ä½œè€…å‹å¥½çš„æ•ˆæœæŠ¥å‘Š | P1 | `{attribution_result, learning_signals}` | `{attribution_id, user_facing_report}` | PostgreSQL, Jinja2 |

**ä¼˜å…ˆçº§è¯´æ˜**ï¼š
- ğŸ”´ **P0 (MVP å¿…é¡»)**ï¼šN1-N4 èŠ‚ç‚¹æ˜¯æ ¸å¿ƒå½’å› èƒ½åŠ›ï¼ŒMVP å¿…é¡»å®ç°
- ğŸŸ¡ **P1 (Phase 2)**ï¼šN5 èŠ‚ç‚¹çš„æ•°æ®åº“æŒä¹…åŒ–åœ¨ Phase 2 å®ç°ï¼ŒMVP å¯ä½¿ç”¨å†…å­˜å­˜å‚¨

### 3.3 Agent å·¥ä½œæµç¨‹ï¼ˆç®€åŒ–ç‰ˆï¼‰

**ä¸»æµç¨‹ï¼š72 å°æ—¶å®šæ—¶å½’å› **

```
æ­¥éª¤ 1: [è§¦å‘å™¨] æ£€æµ‹åˆ°è§†é¢‘å‘å¸ƒ 72 å°æ—¶ â†’ è¿›å…¥é˜Ÿåˆ—
  â†“
æ­¥éª¤ 2: [N1 æ•°æ®å¤„ç†èŠ‚ç‚¹] ğŸ”´ P0
        â”œâ”€ æ•°æ®é‡‡é›†ï¼šè°ƒç”¨ Tikfly API è·å–è§†é¢‘è¯¦æƒ…
        â”œâ”€ åŸºå‡†è®¡ç®—ï¼šæŸ¥è¯¢æˆ–å®æ—¶è®¡ç®—ç”¨æˆ· 30 å¤©åŸºå‡†ï¼ˆä¼˜å…ˆä½¿ç”¨ç¼“å­˜ï¼‰
        â””â”€ æ•ˆæœè¯„ä¼°ï¼šè®¡ç®—ç›¸å¯¹è¡¨ç°è¯„åˆ†ï¼ˆæµé‡/äº’åŠ¨/æ¶¨ç²‰/å˜ç°ï¼‰
  â†“
æ­¥éª¤ 3: [N2 å½’å› åˆ†æèŠ‚ç‚¹] ğŸ”´ P0
        â”œâ”€ è¶‹åŠ¿å½’å› ï¼šé¢„æµ‹å‡†ç¡®æ€§(40%) + å…¥åœºæ—¶æœº(40%) + è¶‹åŠ¿è´¨é‡(20%)
        â”œâ”€ ç”¨æˆ·å½’å› ï¼šèƒ½åŠ›åŒ¹é…(40%) + èµ›é“ç›¸å…³(35%) + å†å²ç¨³å®š(25%)
        â””â”€ æ‰§è¡Œå½’å› ï¼šå†…å®¹è´¨é‡(40%) + è§’åº¦æœ‰æ•ˆ(30%) + æ—¶é—´åˆè§„(20%) + æ‰§è¡Œåˆ°ä½(10%)
  â†“
æ­¥éª¤ 4: [N3 æ´å¯Ÿç”ŸæˆèŠ‚ç‚¹] ğŸ”´ P0
        â”œâ”€ è°ƒç”¨ LLM (KIMI/GPT-4o)
        â”œâ”€ System Prompt: å®šä¹‰å½’å› åˆ†æä¸“å®¶è§’è‰²
        â”œâ”€ User Prompt: è¾“å…¥ä¸‰å› ç´ è¯„åˆ† + è¯¦ç»†æ•°æ®
        â””â”€ è§£æ JSON æ ¼å¼è¾“å‡ºï¼ˆ3 æ¡æ´å¯Ÿ/å› ç´ ï¼‰
  â†“
æ­¥éª¤ 5: [N4 å­¦ä¹ ä¿¡å·èŠ‚ç‚¹] ğŸ”´ P0
        â”œâ”€ æå–è¶‹åŠ¿åå¥½ç³»æ•°è°ƒæ•´ï¼ˆEMA æ›´æ–°ï¼‰
        â”œâ”€ æå–è§’åº¦åå¥½ç³»æ•°è°ƒæ•´ï¼ˆEMA æ›´æ–°ï¼‰
        â””â”€ æå–èƒ½åŠ›è¾¹ç•Œè°ƒæ•´ä¿¡å·
  â†“
æ­¥éª¤ 6: [N5 ç»“æœè¾“å‡ºèŠ‚ç‚¹] ğŸŸ¡ P1
        â”œâ”€ æŒä¹…åŒ–ç»“æœï¼šå†™å…¥ res_effect_attribution è¡¨ï¼ˆPhase 2ï¼‰
        â””â”€ ç”Ÿæˆè¾“å‡ºï¼šåˆ›ä½œè€…æŠ¥å‘Šï¼ˆMarkdownï¼‰+ JSON æ ¼å¼
```

**MVP ç®€åŒ–**ï¼š
- MVP é˜¶æ®µï¼ˆPhase 1ï¼‰ï¼šå®ç°æ­¥éª¤ 2-5ï¼ˆN1-N4 èŠ‚ç‚¹ï¼‰
- Phase 2ï¼šå®ç°æ­¥éª¤ 6ï¼ˆN5 èŠ‚ç‚¹çš„æ•°æ®åº“æŒä¹…åŒ–ï¼‰
- MVP ä½¿ç”¨å†…å­˜å­˜å‚¨ï¼ŒPhase 2 è¿ç§»åˆ° PostgreSQL

### 3.4 å½’å›  Agent å…¨é“¾è·¯é€»è¾‘æµå›¾ (v2.0 ä¿®å¤ç‰ˆ)

```mermaid
graph TD
    %% å®šä¹‰æ ·å¼
    classDef trigger fill:#f9f,stroke:#333,stroke-width:2px;
    classDef process fill:#bbf,stroke:#333,stroke-width:1px;
    classDef fallback fill:#fff4dd,stroke:#d4a017,stroke-width:1px,stroke-dasharray: 5 5;
    classDef storage fill:#dfd,stroke:#333,stroke-width:1px;

    %% è§¦å‘å±‚
    Start((è§†é¢‘å‘å¸ƒ 72h)):::trigger --> N1_Data[N1: æ•°æ®å¤„ç†èŠ‚ç‚¹]
    UserCmd((ç”¨æˆ·ä¸»åŠ¨æŸ¥è¯¢)):::trigger --> N1_Data

    %% N1 èŠ‚ç‚¹ï¼šæ•°æ®é‡‡é›†ä¸åŸºå‡†
    subgraph Node_N1 [N1: æ•°æ®é‡‡é›†ä¸åŸºå‡†è¯„ä¼°]
        N1_Data --> T001[T001: Tikfly API è·å–å¿«ç…§æ•°æ®]
        T001 --> T002_Check{å†å²è§†é¢‘ >= 5?}
        T002_Check -- No --> T002_Fallback[æ³¨å…¥ SYSTEM_DEFAULT åŸºå‡†<br/>æ ‡è®° Confidence=LOW]:::fallback
        T002_Check -- Yes --> T002_Calc[è®¡ç®— 30d æ»šåŠ¨åŸºå‡†æ•°æ®]
        T002_Fallback --> T003[T003: æ•ˆæœè¯„ä¼°è¯„åˆ†]
        T002_Calc --> T003
    end

    %% N2 èŠ‚ç‚¹ï¼šä¸‰å±‚å½’å› æ‹†è§£
    subgraph Node_N2 [N2: ä¸‰å› ç´ å½’å› åˆ†æå±‚]
        T003 --> |äº§å‡º effect_score| N2_Root[å½’å› æƒé‡å¼•æ“]
        N2_Root --> T004[T004: è¶‹åŠ¿å½’å›  40%]
        N2_Root --> T005[T005: ç”¨æˆ·å½’å›  25%]
        N2_Root --> T006[T006: æ‰§è¡Œå½’å›  35% <br/>é€‚é…å¿«ç…§æ•°æ®å…œåº•]
    end

    %% N3/N4 èŠ‚ç‚¹ï¼šæ™ºèƒ½è¿›åŒ–
    subgraph Node_Logic_Evolution [N3 & N4: æ´å¯Ÿç”Ÿæˆä¸å‚æ•°è¿›åŒ–]
        T004 & T005 & T006 --> T007[T007: LLM æ·±åº¦æ´å¯Ÿç”Ÿæˆ]
        T007 --> |ä¸‰å› ç´ è¯„åˆ† + åŸå§‹ä¸Šä¸‹æ–‡| T008[T008: å­¦ä¹ ä¿¡å·æå–]
        T008 --> EMA_Update{EMA ç®—æ³•æ›´æ–°}
        EMA_Update --> |æ–°æƒé‡ = Î±*ä¿¡å· + 1-Î±*åŸæƒé‡| Update_Param[æ›´æ–°ä¸ªæ€§åŒ–æ¨èç³»æ•°]
    end

    %% N5 èŠ‚ç‚¹ï¼šèµ„äº§åŒ–è¾“å‡º
    subgraph Node_N5 [N5: æŒä¹…åŒ–ä¸æŠ¥å‘Š]
        Update_Param --> N5_Save[(å†™å…¥ PostgreSQL)]:::storage
        N5_Save --> Final_Report[ç”Ÿæˆåˆ›ä½œè€… Markdown æŠ¥å‘Š]
    end

    Final_Report --> End((å½’å› å®Œæˆ))

    %% å…³é”®é€»è¾‘æ ‡æ³¨
    Update_Param -.->|é©±åŠ¨è¿›åŒ–| Start
```

### 3.5 Agent çŠ¶æ€æœº

```mermaid
stateDiagram-v2
    [*] --> ç­‰å¾…è§¦å‘
    ç­‰å¾…è§¦å‘ --> æ•°æ®é‡‡é›†: 72h å®šæ—¶è§¦å‘ OR ç”¨æˆ·ä¸»åŠ¨æŸ¥è¯¢
    æ•°æ®é‡‡é›† --> åŸºå‡†è®¡ç®—: æ•°æ®é‡‡é›†æˆåŠŸ
    æ•°æ®é‡‡é›† --> é”™è¯¯å¤„ç†: é‡‡é›†å¤±è´¥ (API è¶…æ—¶/æ•°æ®ç¼ºå¤±)
    
    åŸºå‡†è®¡ç®— --> æ•ˆæœè¯„ä¼°: åŸºå‡†è®¡ç®—å®Œæˆ
    åŸºå‡†è®¡ç®— --> æ•ˆæœè¯„ä¼°: åŸºå‡†æ•°æ®ä¸è¶³(é™çº§ä½¿ç”¨é»˜è®¤åŸºå‡†,confidence=LOW)
    
    æ•ˆæœè¯„ä¼° --> ä¸‰å› ç´ å½’å› : è¯„ä¼°å®Œæˆ
    ä¸‰å› ç´ å½’å›  --> LLM æ´å¯Ÿç”Ÿæˆ: ä¸‰å› ç´ è¯„åˆ†å®Œæˆ
    
    LLM æ´å¯Ÿç”Ÿæˆ --> å­¦ä¹ ä¿¡å·æå–: LLM å“åº”æˆåŠŸ
    LLM æ´å¯Ÿç”Ÿæˆ --> é‡è¯•: LLM è°ƒç”¨å¤±è´¥ (é‡è¯• â‰¤ 3 æ¬¡)
    é‡è¯• --> LLM æ´å¯Ÿç”Ÿæˆ: ç­‰å¾…é€€é¿æ—¶é—´åé‡è¯•
    é‡è¯• --> é”™è¯¯å¤„ç†: é‡è¯•æ¬¡æ•°è€—å°½
    
    å­¦ä¹ ä¿¡å·æå– --> ç»“æœæŒä¹…åŒ–: ä¿¡å·æå–å®Œæˆ
    ç»“æœæŒä¹…åŒ– --> è¾“å‡ºç”Ÿæˆ: å†™å…¥æ•°æ®åº“æˆåŠŸ
    è¾“å‡ºç”Ÿæˆ --> [*]: å½’å› æµç¨‹å®Œæˆ
    
    é”™è¯¯å¤„ç† --> äººå·¥å®¡æ ¸: æ ‡è®°ä¸ºå¼‚å¸¸ä»»åŠ¡
    äººå·¥å®¡æ ¸ --> [*]: äººå·¥å¤„ç†åå…³é—­
```

**çŠ¶æ€æµè½¬é€»è¾‘è¯´æ˜**ï¼š

1.  **ç­‰å¾…è§¦å‘ (Waiting)**:
    - åˆå§‹çŠ¶æ€ã€‚ç³»ç»Ÿç›‘å¬ä¸¤ç±»äº‹ä»¶ï¼š
      - **å®šæ—¶äº‹ä»¶**ï¼šè§†é¢‘å‘å¸ƒæ»¡ 72 å°æ—¶ã€‚
      - **ä¸»åŠ¨äº‹ä»¶**ï¼šç”¨æˆ·æ‰‹åŠ¨è¯·æ±‚å½’å› åˆ†æã€‚
    - è§¦å‘åè¿›å…¥ã€Œæ•°æ®é‡‡é›†ã€çŠ¶æ€ã€‚

2.  **æ•°æ®é‡‡é›† (Data Collection)**:
    - è°ƒç”¨ Tikfly API è·å–è§†é¢‘è¯¦æƒ… (T001)ã€‚
    - **æˆåŠŸ**ï¼šè·å–åˆ°å®Œæ•´æ•°æ®ï¼Œæµè½¬è‡³ã€ŒåŸºå‡†è®¡ç®—ã€ã€‚
    - **å¤±è´¥**ï¼šAPI è¶…æ—¶æˆ–è§†é¢‘ä¸å­˜åœ¨ï¼Œè¿›å…¥ã€Œé”™è¯¯å¤„ç†ã€ã€‚

3.  **åŸºå‡†è®¡ç®— (Baseline Calculation)**:
    - è®¡ç®—æˆ–è·å–ç”¨æˆ·æœ€è¿‘ 30 å¤©çš„å„é¡¹åŸºå‡†æŒ‡æ ‡ (T002)ã€‚
    - **æˆåŠŸ**ï¼šåŸºå‡†æ•°æ®å‡†å¤‡å°±ç»ªï¼Œæµè½¬è‡³ã€Œæ•ˆæœè¯„ä¼°ã€ã€‚
    - **æ•°æ®ä¸è¶³**ï¼šå†å²æ•°æ®ä¸è¶³ (<5 æ¡è§†é¢‘)ï¼Œé™çº§ä½¿ç”¨ SYSTEM_DEFAULT_BASELINEï¼Œæ ‡è®° confidence=LOWï¼Œç»§ç»­æµè½¬è‡³ã€Œæ•ˆæœè¯„ä¼°ã€ã€‚

4.  **æ•ˆæœè¯„ä¼° (Effect Evaluation)**:
    - å¯¹æ¯”å½“å‰è§†é¢‘æ•°æ®ä¸åŸºå‡†æ•°æ®ï¼Œè®¡ç®—æµé‡ã€äº’åŠ¨ã€æ¶¨ç²‰ã€å˜ç°å››ç»´åº¦çš„ç›¸å¯¹è¯„åˆ† (T003)ã€‚
    - **å®Œæˆ**ï¼šç”Ÿæˆç»¼åˆè¯„åˆ†å’Œæ•ˆæœç­‰çº§ï¼Œæµè½¬è‡³ã€Œä¸‰å› ç´ å½’å› ã€ã€‚

5.  **ä¸‰å› ç´ å½’å›  (Attribution Analysis)**:
    - å¹¶è¡Œæ‰§è¡Œä¸‰ä¸ªå­ä»»åŠ¡ï¼š
      - **è¶‹åŠ¿å½’å› ** (T004)ï¼šåˆ†æé¢„æµ‹å‡†ç¡®æ€§å’Œå…¥åœºæ—¶æœºã€‚
      - **ç”¨æˆ·å½’å› ** (T005)ï¼šåˆ†æèƒ½åŠ›åŒ¹é…åº¦å’Œèµ›é“ç›¸å…³æ€§ã€‚
      - **æ‰§è¡Œå½’å› ** (T006)ï¼šåˆ†æå†…å®¹è´¨é‡å’Œæ‰§è¡Œåˆ°ä½åº¦ã€‚
    - **å®Œæˆ**ï¼šæ‰€æœ‰å­ä»»åŠ¡å®Œæˆåï¼Œæµè½¬è‡³ã€ŒLLM æ´å¯Ÿç”Ÿæˆã€ã€‚

6.  **LLM æ´å¯Ÿç”Ÿæˆ (Insight Generation)**:
    - ç»„è£… Promptï¼Œè°ƒç”¨ LLM (GPT-4o) ç”Ÿæˆæ–‡å­—æ´å¯Ÿ (T007)ã€‚
    - **æˆåŠŸ**ï¼šè·å¾— JSON æ ¼å¼çš„æ´å¯Ÿç»“æœï¼Œæµè½¬è‡³ã€Œå­¦ä¹ ä¿¡å·æå–ã€ã€‚
    - **å¤±è´¥**ï¼šç½‘ç»œé”™è¯¯æˆ–è§£æå¤±è´¥ï¼Œè¿›å…¥ã€Œé‡è¯•ã€æœºåˆ¶ï¼ˆæœ€å¤š 3 æ¬¡ï¼‰ã€‚

7.  **å­¦ä¹ ä¿¡å·æå– (Learning Signal Extraction)**:
    - ä»å½’å› ç»“æœä¸­æå–ç”¨äºæ›´æ–°æ¨èç³»ç»Ÿçš„å‚æ•°ä¿¡å· (T008)ã€‚
    - **å®Œæˆ**ï¼šæå–å®Œæˆï¼Œæµè½¬è‡³ã€Œç»“æœæŒä¹…åŒ–ã€ã€‚

8.  **ç»“æœæŒä¹…åŒ– & è¾“å‡º (Persistence & Output)**:
    - å°†å®Œæ•´å½’å› æŠ¥å‘Šå†™å…¥æ•°æ®åº“ (Phase 2) æˆ–å†…å­˜ (MVP)ã€‚
    - ç”Ÿæˆæœ€ç»ˆé¢å‘ç”¨æˆ·çš„ Markdown/JSON æŠ¥å‘Šã€‚
    - **å®Œæˆ**ï¼šæµç¨‹ç»“æŸï¼Œè¿”å›åˆå§‹çŠ¶æ€ã€‚

9.  **å¼‚å¸¸å¤„ç† (Error Handling)**:
    - æ•è·å„é˜¶æ®µçš„ä¸¥é‡é”™è¯¯ã€‚
    - å°è¯•è‡ªåŠ¨æ¢å¤ï¼ˆå¦‚é‡è¯•ã€é™çº§ä½¿ç”¨é»˜è®¤å€¼ï¼‰ã€‚
    - æ— æ³•æ¢å¤æ—¶ï¼Œæ ‡è®°ä»»åŠ¡å¼‚å¸¸å¹¶é€šçŸ¥äººå·¥ä»‹å…¥ã€‚

---

## å››ã€æ•°æ®è¾“å…¥è§„èŒƒ

### 4.1 è§¦å‘è¾“å…¥æ•°æ®

#### 4.1.1 å®šæ—¶è§¦å‘è¾“å…¥

**è§¦å‘æ—¶æœº**ï¼šè§†é¢‘å‘å¸ƒ 72 å°æ—¶åè‡ªåŠ¨è§¦å‘

**è¾“å…¥æ•°æ®ç»“æ„ï¼š**

```json
{
  "trigger_type": "scheduled",
  "video_id": "7572198435487501598",
  "account_id": "ACC_001",
  "publish_time": "2026-02-01T14:30:00Z",
  "trigger_time": "2026-02-04T14:30:00Z",
  "priority": "P1"
}
```

#### 4.1.2 ç”¨æˆ·ä¸»åŠ¨è§¦å‘è¾“å…¥

**è§¦å‘æ—¶æœº**ï¼šç”¨æˆ·åœ¨å‰ç«¯ç‚¹å‡»"æŸ¥çœ‹å½’å› åˆ†æ"

**è¾“å…¥æ•°æ®ç»“æ„ï¼š**

```json
{
  "trigger_type": "user_initiated",
  "video_id": "7572198435487501598",
  "account_id": "ACC_001",
  "user_id": "USER_12345",
  "request_time": "2026-02-04T15:00:00Z",
  "priority": "P0"
}
```

#### 4.1.3 å¼‚å¸¸äº‹ä»¶è§¦å‘è¾“å…¥

**è§¦å‘æ—¶æœº**ï¼šæ’­æ”¾é‡ç¯æ¯”å¼‚å¸¸ Â±50%

**è¾“å…¥æ•°æ®ç»“æ„ï¼š**

```json
{
  "trigger_type": "anomaly_detected",
  "video_id": "7572198435487501598",
  "account_id": "ACC_001",
  "anomaly_type": "views_spike",
  "anomaly_value": 150000,
  "baseline_value": 45000,
  "deviation_percent": 233.33,
  "detected_at": "2026-02-04T16:00:00Z",
  "priority": "P0"
}
```

### 4.2 å¤–éƒ¨æ•°æ®æº

#### 4.2.1 æ•°æ®æºåˆ—è¡¨

| æ•°æ®æºID | æ•°æ®æºåç§° | æ•°æ®ç±»å‹ | è·å–æ–¹å¼ | æ›´æ–°é¢‘ç‡ | è¯´æ˜ |
|----------|------------|----------|----------|----------|------|
| **DS001** | Tikfly è§†é¢‘è¯¦æƒ… | JSON | API: `/api/post/detail` | å®æ—¶ | 72h æ•ˆæœæ•°æ® <br> **âš ï¸ å¹»è§‰æ ‡è®°**: ç¼ºå°‘ T006 æ‰€éœ€çš„ `views_1h` å­—æ®µ |
| **DS002** | Tikfly ç”¨æˆ·ä¿¡æ¯ | JSON | API: `/api/user/info` | å®æ—¶ | è´¦å·åŸºç¡€æ•°æ® |
| **DS003** | Tikfly ç”¨æˆ·å†å²è§†é¢‘ | JSON | API: `/api/user/posts` (åˆ†é¡µ) | å®æ—¶ | è®¡ç®— 30 å¤©åŸºå‡† |
| **DS004** | æ¨èè®°å½•æ•°æ®åº“ | PostgreSQL | è¡¨: `recommendation_records` | å®æ—¶ | åŸå§‹æ¨èç­–ç•¥ |
| **DS005** | ç”¨æˆ·åŸºå‡†ç¼“å­˜ | Redis | Key: `baseline:{account_id}` | TTL=24h | åŠ é€ŸåŸºå‡†æŸ¥è¯¢ |

#### 4.2.2 æ•°æ®æºç»“æ„ç¤ºä¾‹

**DS001 - Tikfly è§†é¢‘è¯¦æƒ… (API å“åº”)ï¼š**

```json
{
  "statusCode": 0,
  "data": {
    "itemInfo": {
      "itemStruct": {
        "id": "7572198435487501598",
        "desc": "Honestly cant think of a better way...",
        "createTime": 1763039850,
        "stats": {
          "playCount": 25000,
          "diggCount": 1200,
          "commentCount": 85,
          "shareCount": 45,
          "collectCount": 156
        },
        "authorStats": {
          "followerCount": 33300000,
          "followingCount": 0,
          "heart": 263500000,
          "videoCount": 78
        },
        "video": {
          "duration": 151,
          "playAddr": "https://..."
        }
      }
    }
  }
}
```

**DS003 - Tikfly ç”¨æˆ·å†å²è§†é¢‘ (ç”¨äºåŸºå‡†è®¡ç®—)ï¼š**

```json
{
  "statusCode": 0,
  "data": {
    "cursor": "1729260489000",
    "hasMore": true,
    "itemList": [
      {
        "id": "7572198435487501598",
        "createTime": 1763039850,
        "stats": {
          "playCount": 25000,
          "diggCount": 1200,
          "commentCount": 85,
          "shareCount": 45,
          "collectCount": 156
        }
      }
      // ... æ›´å¤šè§†é¢‘
    ]
  }
}
```

**DS004 - æ¨èè®°å½•æ•°æ®åº“æŸ¥è¯¢ç»“æœï¼š**

```json
{
  "recommendation_id": "REC_001",
  "video_id": "7572198435487501598",
  "account_id": "ACC_001",
  "trend_info": {
    "trend_name": "Skincare Routines",
    "trend_type": "rising",
    "predicted_heat_score": 85,
    "predicted_peak_time": "2026-01-15T16:00:00Z",
    "trend_stage": "rising"
  },
  "recommended_strategy": {
    "publish_time": "2026-01-15T14:00:00Z",
    "content_angle": "Problem-Solution",
    "difficulty_level": "Medium",
    "expected_performance": {
      "views": 30000,
      "engagement_rate": 0.045
    }
  },
  "created_at": "2026-01-14T10:00:00Z"
}
```

### 4.3 å†…éƒ¨æ•°æ®ä¾èµ–

#### 4.3.1 ç”¨æˆ·åŸºå‡†æ•°æ®ç»“æ„

**æ•°æ®æ¥æº**ï¼š`user_baseline_metrics` è¡¨ OR å®æ—¶è®¡ç®—

```json
{
  "account_id": "ACC_001",
  "calculation_period": "2026-01-05 to 2026-02-04",
  "baseline_metrics": {
    "avg_views_30d": 8500,
    "avg_engagement_rate_30d": 0.042,
    "avg_follower_conversion_30d": 0.0092,
    "avg_views_1h_30d": 420,
    "avg_gmv_per_1k_views_30d": 12.5,
    "post_count_30d": 15
  },
  "trend_coefficients": {
    "rising": 1.05,
    "viral": 0.95,
    "emerging": 0.85,
    "cyclical": 1.10
  },
  "angle_coefficients": {
    "problem_solving": 1.10,
    "storytelling": 0.90,
    "product_review": 1.15
  },
  "capability_boundary": {
    "current_level": 4.2,
    "max_complexity": 6.0
  },
  "last_updated_at": "2026-02-04T00:00:00Z"
}
```

#### 4.3.2 æ‰§è¡Œè®°å½•æ•°æ®ç»“æ„

**æ•°æ®æ¥æº**ï¼š`execution_records` è¡¨

```json
{
  "execution_id": "EXEC_001",
  "video_id": "7572198435487501598",
  "recommendation_id": "REC_001",
  "planned_content": {
    "topic": "5åˆ†é’Ÿé«˜æ•ˆæŠ¤è‚¤routine",
    "script_template": "Hook-Body-CTA",
    "target_length": "55-60 seconds",
    "recommended_tags": ["#SkincareRoutine", "#SkincareTips"],
    "recommended_publish_time": "2026-01-15T14:00:00Z"
  },
  "actual_execution": {
    "actual_publish_time": "2026-01-15T14:32:00Z",
    "final_title": "5åˆ†é’Ÿæå®šå…¨è„¸æŠ¤è‚¤ï¼ä¸Šç­æ—å¿…å¤‡",
    "used_tags": ["#SkincareRoutine", "#QuickSkincare", "#MorningRoutine"],
    "content_length": 58,
    "thumbnail_uploaded": true
  },
  "compliance_scores": {
    "time_compliance": 0.97,
    "content_compliance": 0.89,
    "tag_compliance": 0.75
  }
}
```

### 4.4 æ•°æ®éªŒè¯è§„åˆ™

| å­—æ®µ | éªŒè¯è§„åˆ™ | é”™è¯¯ä»£ç  | é”™è¯¯å¤„ç† |
|------|----------|---------|----------|
| `video_id` | éç©ºï¼Œæ ¼å¼ï¼š`^[0-9]{19}$` | E_INPUT_001 | è¿”å› 400 é”™è¯¯ï¼Œæç¤ºæ ¼å¼é”™è¯¯ |
| `account_id` | éç©ºï¼Œå¿…é¡»åœ¨ç³»ç»Ÿä¸­å­˜åœ¨ | E_INPUT_002 | è¿”å› 404 é”™è¯¯ï¼Œæç¤ºè´¦æˆ·ä¸å­˜åœ¨ |
| `publish_time` | éç©ºï¼Œå¿…é¡» â‰¤ å½“å‰æ—¶é—´ - 48h | E_INPUT_003 | è¿”å› 400 é”™è¯¯ï¼Œæç¤ºæ•°æ®æœªæ»¡ 72h |
| `performance_data.playCount` | å¿…é¡» > 0 | E_INPUT_004 | é™ä½ç½®ä¿¡åº¦ï¼Œæ ‡è®°"æ•°æ®å¼‚å¸¸" |
| `baseline_metrics.post_count_30d` | å¿…é¡» â‰¥ 5 | E_INPUT_005 | è¿”å› 422 é”™è¯¯ï¼Œæç¤ºå†å²æ•°æ®ä¸è¶³ |

---

## äº”ã€Tools & Skills è®¾è®¡

### 5.1 Tools åˆ—è¡¨

#### **Tool T001: fetch_video_performance**

**åŠŸèƒ½æè¿°ï¼š**  
ä» Tikfly API è·å–è§†é¢‘ 72 å°æ—¶æ•ˆæœæ•°æ®ï¼ŒåŒ…æ‹¬æ’­æ”¾é‡ã€äº’åŠ¨æ•°æ®ã€æ—¶é—´åºåˆ—æ•°æ®ã€‚

**è¾“å…¥å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| `video_id` | string | âœ… | TikTok è§†é¢‘ ID | `"7572198435487501598"` |

**è¾“å…¥ç¤ºä¾‹ï¼š**

```json
{
  "video_id": "7572198435487501598"
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

```json
{
  "status": "success",
  "data": {
    "video_id": "7572198435487501598",
    "publish_time": "2026-02-01T14:30:00Z",
    "data_collection_time": "2026-02-04T14:30:00Z",
    "performance_72h": {
      "view_count": 25000,
      "like_count": 1200,
      "comment_count": 85,
      "share_count": 45,
      "favorite_count": 156,
      "engagement_rate": 0.0594
    },
    "time_series": {
      "views_1h": 1200,
      "views_6h": 5800,
      "views_24h": 18500,
      "views_48h": 22000,
      "views_72h": 25000
    },
    "author_stats": {
      "follower_count_before": 33275000,
      "follower_count_after": 33300000,
      "follower_gain": 25000
    }
  },
  "metadata": {
    "api_endpoint": "/api/post/detail",
    "response_time_ms": 523
  }
}
```

**è°ƒç”¨æ¡ä»¶ï¼š**
- å½’å› åˆ†ææµç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œå¿…é¡»è°ƒç”¨
- ç¼“å­˜ç­–ç•¥ï¼šç›¸åŒ `video_id` åœ¨ 1 å°æ—¶å†…å¤ç”¨ç¼“å­˜

**é”™è¯¯å¤„ç†ï¼š**

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|--------|----------|----------|
| `E_T001_001` | Video not found | è¿”å›å‹å¥½æç¤ºï¼Œç»ˆæ­¢å½’å› æµç¨‹ |
| `E_T001_002` | API rate limit exceeded | ç­‰å¾… 60 ç§’åé‡è¯•ï¼Œæœ€å¤š 3 æ¬¡ |
| `E_T001_003` | Incomplete data (<30% fields) | é™ä½ç½®ä¿¡åº¦ï¼Œç»§ç»­åˆ†æä½†æ ‡è®°"æ•°æ®ä¸å®Œæ•´" |

---

#### **Tool T002: calculate_baseline_metrics**

**åŠŸèƒ½æè¿°ï¼š**  
è®¡ç®—ç”¨æˆ· 30 å¤©æ»šåŠ¨åŸºå‡†æŒ‡æ ‡ï¼Œä¼˜å…ˆä½¿ç”¨ç¼“å­˜ï¼Œç¼“å­˜å¤±æ•ˆæ—¶é€šè¿‡ Tikfly API å®æ—¶è®¡ç®—ã€‚

**è¾“å…¥å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹å€¼ |
|--------|------|------|------|--------|
| `account_id` | string | âœ… | è´¦æˆ· ID | `"ACC_001"` |
| `force_refresh` | boolean | âŒ | æ˜¯å¦å¼ºåˆ¶åˆ·æ–°ç¼“å­˜ | `false` |

**è¾“å…¥ç¤ºä¾‹ï¼š**

```json
{
  "account_id": "ACC_001",
  "force_refresh": false
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

```json
{
  "status": "success",
  "data": {
    "account_id": "ACC_001",
    "calculation_period": "2026-01-05 to 2026-02-04",
    "baseline_metrics": {
      "avg_views_30d": 8500,
      "avg_engagement_rate_30d": 0.042,
      "avg_follower_conversion_30d": 0.0092,
      "avg_views_1h_30d": 420,
      "avg_gmv_per_1k_views_30d": 12.5
    },
    "sample_size": 15,
    "data_source": "redis_cache"
  },
  "metadata": {
    "cache_hit": true,
    "calculation_time_ms": 12
  }
}
```

**å¤„ç†é€»è¾‘ï¼š**

**ç®—æ³•é€»è¾‘è¯´æ˜**ï¼š
1.  **ç¼“å­˜ä¼˜å…ˆ**ï¼šé¦–å…ˆæ£€æŸ¥ Redis ç¼“å­˜ä¸­æ˜¯å¦å­˜åœ¨è¯¥ç”¨æˆ·çš„æœ‰æ•ˆåŸºå‡†æ•°æ®ï¼ˆ24å°æ—¶å†…ï¼‰ã€‚å¦‚æœå­˜åœ¨ä¸”æœªå¼ºåˆ¶åˆ·æ–°ï¼Œç›´æ¥è¿”å›ç¼“å­˜æ•°æ®ã€‚
2.  **æ•°æ®è·å–**ï¼šå¦‚æœç¼“å­˜æœªå‘½ä¸­ï¼Œè°ƒç”¨ Tikfly API è·å–ç”¨æˆ·æœ€è¿‘å‘å¸ƒçš„è§†é¢‘åˆ—è¡¨ã€‚éå†åˆ—è¡¨ï¼Œç­›é€‰å‡ºå‘å¸ƒæ—¶é—´åœ¨æœ€è¿‘ 30 å¤©å†…çš„è§†é¢‘ï¼Œæœ€å¤šè·å– 35 æ¡ä»¥ç¡®ä¿æ ·æœ¬å……è¶³ã€‚
3.  **æŒ‡æ ‡èšåˆ**ï¼šéå†ç­›é€‰å‡ºçš„è§†é¢‘ï¼Œç´¯åŠ æ’­æ”¾é‡ã€ç‚¹èµæ•°ã€è¯„è®ºæ•°ã€åˆ†äº«æ•°å’Œæ”¶è—æ•°ã€‚
4.  **å‡å€¼è®¡ç®—**ï¼š
    - `avg_views_30d` = æ€»æ’­æ”¾é‡ / è§†é¢‘æ•°é‡
    - `avg_engagement_rate_30d` = (æ€»äº’åŠ¨æ•° / æ€»æ’­æ”¾é‡)
    - äº’åŠ¨æ•°åŒ…æ‹¬ç‚¹èµã€è¯„è®ºã€åˆ†äº«å’Œæ”¶è—ã€‚
5.  **ç¼“å­˜æ›´æ–°**ï¼šå°†è®¡ç®—ç»“æœå­˜å…¥ Redisï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´ä¸º 24 å°æ—¶ã€‚

```python
# ç³»ç»Ÿé»˜è®¤åŸºå‡†ï¼ˆå†·å¯åŠ¨å…œåº•å€¼ï¼Œæ»¡è¶³ CLAUDE.md Assertion 3ï¼‰
SYSTEM_DEFAULT_BASELINE = {
    "avg_views_30d": 500,
    "avg_engagement_rate_30d": 0.05,
    "avg_follower_conversion_30d": 0.005,
    "avg_views_1h_30d": 50,
    "avg_gmv_per_1k_views_30d": 0,
}

def calculate_baseline_metrics(account_id, force_refresh=False):
    # æ­¥éª¤ 1: å°è¯•ä» Redis ç¼“å­˜è¯»å–
    if not force_refresh:
        cached_data = redis.get(f"baseline:{account_id}")
        if cached_data and not is_expired(cached_data):
            return cached_data

    # æ­¥éª¤ 2: ç¼“å­˜æœªå‘½ä¸­ï¼Œè°ƒç”¨ Tikfly API è·å–æœ€è¿‘ 30 å¤©è§†é¢‘
    videos = []
    cursor = "0"
    cutoff_date = datetime.utcnow() - timedelta(days=30)

    while cursor:
        response = tikfly_api.get_user_posts(sec_uid, count=35, cursor=cursor)
        for video in response["itemList"]:
            if datetime.fromtimestamp(video["createTime"]) < cutoff_date:
                cursor = None
                break
            videos.append(video)
        cursor = response.get("cursor") if response.get("hasMore") else None

    # æ­¥éª¤ 2.5: å†·å¯åŠ¨å…œåº•ï¼ˆæ»¡è¶³ CLAUDE.md Assertion 3: Cold Start Fallbackï¼‰
    # å½“è§†é¢‘æ•° < 5 æ—¶ï¼Œæ³¨å…¥ç³»ç»Ÿé»˜è®¤åŸºå‡†ï¼Œæ ‡è®° confidence=LOW
    if len(videos) < 5:
        baseline = SYSTEM_DEFAULT_BASELINE.copy()
        baseline["sample_size"] = len(videos)
        baseline["data_source"] = "system_default"
        baseline["confidence"] = "LOW"
        # å¦‚æœæœ‰ 1-4 æ¡è§†é¢‘ï¼Œç”¨å®é™…æ•°æ®åšåŠ æƒæ··åˆ
        if len(videos) > 0:
            actual_avg_views = sum(v["stats"]["playCount"] for v in videos) / len(videos)
            alpha = len(videos) / 5  # 0.2 ~ 0.8
            baseline["avg_views_30d"] = int(
                alpha * actual_avg_views + (1 - alpha) * SYSTEM_DEFAULT_BASELINE["avg_views_30d"]
            )
        redis.setex(f"baseline:{account_id}", 86400, json.dumps(baseline))
        return baseline

    # æ­¥éª¤ 3: æ­£å¸¸è®¡ç®—åŸºå‡†æŒ‡æ ‡ (len >= 5)
    total_views = sum(v["stats"]["playCount"] for v in videos)
    total_engagement = sum(
        v["stats"]["diggCount"] + v["stats"]["commentCount"] +
        v["stats"]["shareCount"] + v["stats"]["collectCount"]
        for v in videos
    )

    baseline = {
        "avg_views_30d": total_views / len(videos),
        "avg_engagement_rate_30d": total_engagement / total_views,
        "sample_size": len(videos),
        "data_source": "calculated",
        "confidence": "HIGH"
    }

    # æ­¥éª¤ 4: å†™å…¥ Redis ç¼“å­˜ (TTL=24h)
    redis.setex(f"baseline:{account_id}", 86400, json.dumps(baseline))

    return baseline
```

**è°ƒç”¨æ¡ä»¶ï¼š**
- æ•ˆæœè¯„ä¼°èŠ‚ç‚¹ï¼ˆN003ï¼‰å‰å¿…é¡»è°ƒç”¨
- æ ·æœ¬é‡ < 5 æ¡è§†é¢‘æ—¶é™çº§ä½¿ç”¨ SYSTEM_DEFAULT_BASELINEï¼ˆæ ‡è®° confidence=LOWï¼‰ï¼Œä¸ç»ˆæ­¢æµç¨‹

**é”™è¯¯å¤„ç†ï¼š**

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|--------|----------|----------|
| `E_T002_001` | Account not found in Tikfly | è¿”å› 404ï¼Œç»ˆæ­¢æµç¨‹ |
| `E_T002_002` | Insufficient historical data (<5 videos) | é™çº§ä½¿ç”¨ SYSTEM_DEFAULT_BASELINEï¼Œæ ‡è®° confidence=LOWï¼Œç»§ç»­å½’å› æµç¨‹ï¼ˆæ»¡è¶³å†·å¯åŠ¨å…œåº•å¾‹ï¼‰ |
| `E_T002_003` | API failure during calculation | é™çº§ä½¿ç”¨é€šç”¨è¡Œä¸šåŸºå‡†ï¼ˆæ ‡è®°"ä½¿ç”¨é»˜è®¤åŸºå‡†"ï¼‰ |

---

#### **Tool T003: evaluate_effect_score**

**åŠŸèƒ½æè¿°ï¼š**  
åŸºäºç›¸å¯¹è¯„ä¼°åŸåˆ™ï¼Œè®¡ç®—æµé‡/äº’åŠ¨/æ¶¨ç²‰/å˜ç°å››ç»´åº¦è¯„åˆ†ï¼Œæ˜ å°„åˆ°æ•ˆæœç­‰çº§ã€‚

**è¾“å…¥å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `performance_data` | object | âœ… | è§†é¢‘æ•ˆæœæ•°æ® |
| `baseline_metrics` | object | âœ… | ç”¨æˆ· 30 å¤©åŸºå‡† |
| `account_level` | integer | âœ… | è´¦å·å±‚çº§ (L0-L7) |

**è¾“å…¥ç¤ºä¾‹ï¼š**

```json
{
  "performance_data": {
    "view_count": 25000,
    "engagement_rate": 0.0594,
    "follower_gain_48h": 23,
    "gmv": null
  },
  "baseline_metrics": {
    "avg_views_30d": 8500,
    "avg_engagement_rate_30d": 0.042,
    "avg_follower_conversion_30d": 0.0092
  },
  "account_level": 4
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

```json
{
  "status": "success",
  "data": {
    "effect_score": 82.5,
    "effect_level": "excellent",
    "dimension_scores": {
      "traffic": {
        "score": 95.2,
        "weight": 0.4,
        "relative_performance": 2.94,
        "contribution": 38.08
      },
      "engagement": {
        "score": 78.6,
        "weight": 0.3,
        "relative_performance": 1.41,
        "contribution": 23.58
      },
      "growth": {
        "score": 68.3,
        "weight": 0.2,
        "relative_performance": 1.1,
        "contribution": 13.66
      },
      "monetization": {
        "score": null,
        "weight": 0.1,
        "relative_performance": null,
        "contribution": 0
      }
    },
    "calculation_details": {
      "used_weights": {"traffic": 0.4, "engagement": 0.3, "growth": 0.2, "monetization": 0.1},
      "adjustment_reason": null,
      "note": "effect_score æ˜¯å››ç»´æ•ˆæœè¯„åˆ†ï¼Œoverall_score ç”± N2 ä¸‰å› ç´ åŠ æƒäº§å‡º: overall = trendÃ—0.4 + userÃ—0.25 + executionÃ—0.35"
    }
  }
}
```

**æ ¸å¿ƒç®—æ³•ï¼ˆè¯¦ç»†å®ç°ï¼‰ï¼š**

**ç®—æ³•é€»è¾‘è¯´æ˜**ï¼š
1.  **ç›¸å¯¹è¯„ä¼°æ ¸å¿ƒ**ï¼šæœ¬ç®—æ³•çš„æ ¸å¿ƒåœ¨äº"ç›¸å¯¹å€¼"ï¼ˆRelative Valueï¼‰ï¼Œå³å½“å‰è§†é¢‘è¡¨ç°é™¤ä»¥ç”¨æˆ·å†å²åŸºå‡†ã€‚ä¾‹å¦‚ï¼Œç›¸å¯¹æµé‡ = å½“å‰æ’­æ”¾é‡ / 30å¤©å¹³å‡æ’­æ”¾é‡ã€‚
2.  **è¯„åˆ†æ˜ å°„**ï¼šä½¿ç”¨çº¿æ€§æ’å€¼æ³•å°†ç›¸å¯¹å€¼æ˜ å°„ä¸º 0-100 çš„æ ‡å‡†åˆ†ã€‚
    - 3.0 å€åŸºå‡† -> 100 åˆ†
    - 2.0 å€åŸºå‡† -> 85 åˆ†
    - 1.0 å€åŸºå‡† -> 55 åˆ†ï¼ˆåŠæ ¼çº¿ï¼‰
    - 0.7 å€åŸºå‡† -> 40 åˆ†
3.  **ç»´åº¦åŠ æƒ**ï¼š
    - **æµé‡æ•ˆæœ (40%)**ï¼šåŸºäºæ’­æ”¾é‡ã€‚
    - **äº’åŠ¨æ•ˆæœ (30%)**ï¼šåŸºäºäº’åŠ¨ç‡ï¼ˆç‚¹èµ+è¯„è®º+åˆ†äº«+æ”¶è— / æ’­æ”¾ï¼‰ã€‚
    - **æ¶¨ç²‰æ•ˆæœ (20%)**ï¼šåŸºäºè½¬ç²‰ç‡ï¼ˆæ¶¨ç²‰æ•° / æ’­æ”¾é‡ï¼‰ã€‚
    - **å˜ç°æ•ˆæœ (10%)**ï¼šåŸºäº GPMï¼ˆåƒæ¬¡æ’­æ”¾ GMVï¼‰ï¼Œä»…é’ˆå¯¹ L3+ è´¦å·ï¼Œå¦åˆ™æƒé‡æŒ‰æ¯”ä¾‹åˆ†é…ç»™å…¶ä»–ç»´åº¦ã€‚
4.  **ç­‰çº§åˆ’åˆ†**ï¼šæ ¹æ®ç»¼åˆè¯„åˆ†åˆ’åˆ†ç­‰çº§ï¼ˆViral/Excellent/Good/Average/Poorï¼‰ã€‚

```python
# ç›¸å¯¹å€¼ â†’ è¯„åˆ†æ˜ å°„è¡¨
SCORE_MAPPING = {
    3.0: 100,  # 3 å€åŸºå‡† = æ»¡åˆ†
    2.0: 85,   # 2 å€åŸºå‡† = ä¼˜ç§€
    1.5: 70,   # 1.5 å€ = è‰¯å¥½
    1.0: 55,   # æŒå¹³ = ä¸€èˆ¬
    0.7: 40,   # 70% = ç•¥ä½
    0.0: 0     # ä½äº 70% = æå·®
}

def map_relative_to_score(relative_value):
    """çº¿æ€§æ’å€¼è®¡ç®—è¯„åˆ†"""
    thresholds = sorted(SCORE_MAPPING.keys(), reverse=True)
    
    for i, threshold in enumerate(thresholds):
        if relative_value >= threshold:
            if i == 0:  # è¶…è¿‡æœ€é«˜é˜ˆå€¼
                return SCORE_MAPPING[threshold]
            else:
                # çº¿æ€§æ’å€¼
                upper_t = thresholds[i-1]
                lower_t = threshold
                upper_s = SCORE_MAPPING[upper_t]
                lower_s = SCORE_MAPPING[lower_t]
                ratio = (relative_value - lower_t) / (upper_t - lower_t)
                return lower_s + (upper_s - lower_s) * ratio
    return 0.0

def evaluate_effect_score(performance_data, baseline_metrics, account_level):
    # 1. æµé‡æ•ˆæœè¯„åˆ†
    traffic_relative = performance_data["view_count"] / baseline_metrics["avg_views_30d"]
    traffic_score = map_relative_to_score(traffic_relative)
    
    # 2. äº’åŠ¨æ•ˆæœè¯„åˆ†
    engagement_relative = performance_data["engagement_rate"] / baseline_metrics["avg_engagement_rate_30d"]
    engagement_score = map_relative_to_score(engagement_relative)
    
    # 3. æ¶¨ç²‰æ•ˆæœè¯„åˆ†
    conversion_rate = performance_data["follower_gain_48h"] / performance_data["view_count"]
    conversion_relative = conversion_rate / baseline_metrics["avg_follower_conversion_30d"]
    growth_score = map_relative_to_score(conversion_relative)
    
    # 4. å˜ç°æ•ˆæœè¯„åˆ†ï¼ˆä»… L3+ è´¦å·ä¸”æœ‰ GMV æ•°æ®ï¼‰
    monetization_score = None
    if account_level >= 3 and performance_data.get("gmv"):
        gmv_per_1k = (performance_data["gmv"] / performance_data["view_count"]) * 1000
        gmv_relative = gmv_per_1k / baseline_metrics["avg_gmv_per_1k_views_30d"]
        monetization_score = map_relative_to_score(gmv_relative)
    
    # 5. æ•ˆæœè¯„åˆ†ï¼ˆå››ç»´åŠ æƒï¼Œæ³¨æ„ï¼šè¿™æ˜¯ effect_scoreï¼Œä¸æ˜¯æœ€ç»ˆ overall_scoreï¼‰
    # overall_score ç”± N2 ä¸‰å› ç´ å½’å› åŠ æƒäº§å‡º: trendÃ—0.4 + userÃ—0.25 + executionÃ—0.35
    effect_score = (
        traffic_score * 0.4 +
        engagement_score * 0.3 +
        growth_score * 0.2 +
        (monetization_score or 0) * 0.1
    )

    # 6. æ•ˆæœç­‰çº§æ˜ å°„
    if effect_score >= 85:
        effect_level = "viral"
    elif effect_score >= 70:
        effect_level = "excellent"
    elif effect_score >= 55:
        effect_level = "good"
    elif effect_score >= 40:
        effect_level = "average"
    else:
        effect_level = "poor"

    return {
        "effect_score": effect_score,
        "effect_level": effect_level,
        "dimension_scores": {...}  # è¯¦ç»†ç»´åº¦æ•°æ®
    }
```

**è°ƒç”¨æ¡ä»¶ï¼š**
- N003 æ•ˆæœè¯„ä¼°èŠ‚ç‚¹å¿…é¡»è°ƒç”¨
- å¿…é¡»åœ¨ T001ã€T002 æ‰§è¡ŒæˆåŠŸåæ‰èƒ½è°ƒç”¨

**é”™è¯¯å¤„ç†ï¼š**

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|--------|----------|----------|
| `E_T003_001` | Missing required performance data | è¿”å› 400ï¼Œæç¤ºæ•°æ®ä¸å®Œæ•´ |
| `E_T003_002` | Baseline metrics unavailable | ä½¿ç”¨è¡Œä¸šé»˜è®¤åŸºå‡†ï¼ˆæ ‡è®°"ä½¿ç”¨é»˜è®¤"ï¼‰ |
| `E_T003_003` | Division by zero in calculation | å°†è¯¥ç»´åº¦è¯„åˆ†è®¾ä¸º 0ï¼Œç»§ç»­è®¡ç®—å…¶ä»–ç»´åº¦ |

---

#### **Tool T004: analyze_trend_factor**

**åŠŸèƒ½æè¿°ï¼š**  
åˆ†æè¶‹åŠ¿å› ç´ å½’å› ï¼Œè®¡ç®—é¢„æµ‹å‡†ç¡®æ€§ã€å…¥åœºæ—¶æœºã€è¶‹åŠ¿è´¨é‡ä¸‰ä¸ªå­ç»´åº¦è¯„åˆ†ã€‚

**è¾“å…¥å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `video_id` | string | âœ… | è§†é¢‘ ID |
| `recommendation_context` | object | âœ… | æ¨èè®°å½•ä¸­çš„è¶‹åŠ¿ä¿¡æ¯ |
| `performance_data` | object | âœ… | å®é™…æ•ˆæœæ•°æ® |

**è¾“å…¥ç¤ºä¾‹ï¼š**

```json
{
  "video_id": "7572198435487501598",
  "recommendation_context": {
    "trend_name": "Skincare Routines",
    "trend_type": "rising",
    "predicted_heat_score": 85,
    "predicted_peak_time": "2026-01-15T16:00:00Z",
    "trend_stage": "rising"
  },
  "performance_data": {
    "actual_publish_time": "2026-01-15T14:32:00Z",
    "view_count": 25000
  }
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

```json
{
  "status": "success",
  "data": {
    "trend_factor_score": 82.5,
    "weight": 0.4,
    "contribution": 33.0,
    "sub_dimensions": {
      "prediction_accuracy": {
        "score": 85.0,
        "weight": 0.4,
        "details": {
          "predicted_heat": 85,
          "actual_heat": 78,
          "prediction_error_percent": 8.24
        }
      },
      "timing_score": {
        "score": 90.0,
        "weight": 0.4,
        "details": {
          "hours_to_peak": 1.47,
          "optimal_window": "[-2h, +12h]",
          "is_in_window": true
        }
      },
      "quality_score": {
        "score": 75.0,
        "weight": 0.2,
        "details": {
          "sustainability": "high",
          "authenticity": "verified",
          "commercial_value": 80
        }
      }
    }
  }
}
```

**æ ¸å¿ƒç®—æ³•ï¼š**

**ç®—æ³•é€»è¾‘è¯´æ˜**ï¼š
1.  **é¢„æµ‹å‡†ç¡®æ€§ (40%)**ï¼š
    - å¯¹æ¯”æ¨èæ—¶çš„`é¢„æµ‹çƒ­åº¦`ä¸å®é™…çš„`å¸‚åœºçƒ­åº¦`ï¼ˆå–ç›¸å…³å…³é”®è¯ Top 50 è§†é¢‘å¹³å‡æ’­æ”¾é‡ä½œä¸ºä»£ç†ï¼‰ã€‚
    - è®¡ç®—è¯¯å·®ç™¾åˆ†æ¯”ï¼Œè¯¯å·®è¶Šå°å¾—åˆ†è¶Šé«˜ã€‚
2.  **å…¥åœºæ—¶æœº (40%)**ï¼š
    - è®¡ç®—è§†é¢‘`å‘å¸ƒæ—¶é—´`ä¸è¶‹åŠ¿`é¢„æµ‹å³°å€¼æ—¶é—´`çš„æ—¶é—´å·®ã€‚
    - æœ€ä½³çª—å£æœŸå®šä¹‰ä¸ºï¼šå³°å€¼å‰ 2 å°æ—¶è‡³å³°å€¼å 12 å°æ—¶ã€‚
    - åœ¨çª—å£æœŸå†…ï¼Œè·ç¦»å³°å€¼è¶Šè¿‘å¾—åˆ†è¶Šé«˜ï¼›è¶…å‡ºçª—å£æœŸå¾—åˆ†æ€¥å‰§ä¸‹é™ã€‚
3.  **è¶‹åŠ¿è´¨é‡ (20%)**ï¼š
    - åŸºäºå†å²æ•°æ®ï¼ŒæŸ¥è¯¢è¯¥è¶‹åŠ¿åœ¨è¿‡å» 30 å¤©å†…æ‰€æœ‰ç›¸å…³è§†é¢‘çš„å¹³å‡å¾—åˆ†ã€‚
    - å¦‚æœè¯¥è¶‹åŠ¿å†å²è¡¨ç°æ™®éè¾ƒå¥½ï¼Œåˆ™åŸºç¡€è´¨é‡åˆ†è¾ƒé«˜ã€‚

```python
def analyze_trend_factor(video_id, recommendation_context, performance_data):
    # 1. é¢„æµ‹å‡†ç¡®æ€§è¯„ä¼°
    # éœ€è¦è°ƒç”¨ Tikfly API è·å–è¶‹åŠ¿å®é™…çƒ­åº¦
    actual_trend_heat = tikfly_api.get_trending_video_by_keyword(
        keyword=recommendation_context["trend_name"],
        count=50
    )
    # ç®€åŒ–ï¼šä½¿ç”¨ Top 50 å¹³å‡æ’­æ”¾é‡ä½œä¸ºå®é™…çƒ­åº¦ä»£ç†
    actual_heat_proxy = sum(v["stats"]["playCount"] for v in actual_trend_heat) / 50
    
    predicted_heat = recommendation_context["predicted_heat_score"]
    prediction_error = abs(actual_heat_proxy - predicted_heat) / predicted_heat
    prediction_accuracy = max(0, 100 - prediction_error * 100)
    
    # 2. å…¥åœºæ—¶æœºè¯„ä¼°
    publish_time = datetime.fromisoformat(performance_data["actual_publish_time"])
    peak_time = datetime.fromisoformat(recommendation_context["predicted_peak_time"])
    hours_to_peak = (peak_time - publish_time).total_seconds() / 3600
    
    if -2 <= hours_to_peak <= 12:  # æœ€ä½³çª—å£æœŸ
        timing_score = 100 - abs(hours_to_peak) * 3  # è·ç¦»å³°å€¼è¶Šè¿‘åˆ†æ•°è¶Šé«˜
    else:
        timing_score = max(0, 50 - abs(hours_to_peak - 5) * 5)
    
    # 3. è¶‹åŠ¿è´¨é‡è¯„ä¼°ï¼ˆåŸºäºå†å²æ•°æ®ï¼‰
    # æŸ¥è¯¢è¯¥è¶‹åŠ¿çš„å†å²æˆåŠŸç‡
    trend_quality = db.query(f"""
        SELECT AVG(overall_score) as avg_score
        FROM res_effect_attribution
        WHERE JSON_EXTRACT(trend_attribution, '$.trend_name') = '{recommendation_context["trend_name"]}'
        AND created_at >= NOW() - INTERVAL 30 DAY
    """)
    quality_score = min(100, trend_quality["avg_score"] * 1.2)  # å½’ä¸€åŒ–åˆ° 0-100
    
    # 4. ç»¼åˆè¯„åˆ†
    trend_factor_score = (
        prediction_accuracy * 0.4 +
        timing_score * 0.4 +
        quality_score * 0.2
    )
    
    return {
        "trend_factor_score": trend_factor_score,
        "sub_dimensions": {...}
    }
```

**è°ƒç”¨æ¡ä»¶ï¼š**
- N004 è¶‹åŠ¿å½’å› èŠ‚ç‚¹è°ƒç”¨
- å¿…é¡»åœ¨ T001 æ‰§è¡ŒæˆåŠŸåè°ƒç”¨

**é”™è¯¯å¤„ç†ï¼š**

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|--------|----------|----------|
| `E_T004_001` | Trend data not available in Tikfly | ä»…åŸºäºé¢„æµ‹æ•°æ®è¯„ä¼°ï¼Œé™ä½ç½®ä¿¡åº¦ |
| `E_T004_002` | No historical data for this trend | è´¨é‡è¯„åˆ†ä½¿ç”¨é»˜è®¤å€¼ 70 åˆ† |

---

#### **Tool T005: analyze_user_factor**

**åŠŸèƒ½æè¿°ï¼š**  
åˆ†æç”¨æˆ·å› ç´ å½’å› ï¼Œè®¡ç®—èƒ½åŠ›åŒ¹é…åº¦ã€èµ›é“ç›¸å…³æ€§ã€å†å²ç¨³å®šæ€§ä¸‰ä¸ªå­ç»´åº¦è¯„åˆ†ã€‚

**è¾“å…¥å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `account_id` | string | âœ… | è´¦æˆ· ID |
| `recommendation_context` | object | âœ… | æ¨èè®°å½• |
| `baseline_metrics` | object | âœ… | ç”¨æˆ·åŸºå‡†æ•°æ® |

**è¾“å…¥ç¤ºä¾‹ï¼š**

```json
{
  "account_id": "ACC_001",
  "recommendation_context": {
    "trend_name": "Skincare Routines",
    "difficulty_level": "Medium",
    "niche_relevance": 88
  },
  "baseline_metrics": {
    "avg_views_30d": 8500,
    "capability_boundary": {"current_level": 4.2}
  }
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

```json
{
  "status": "success",
  "data": {
    "user_factor_score": 75.3,
    "weight": 0.25,
    "contribution": 18.83,
    "sub_dimensions": {
      "capability_match": {
        "score": 82.0,
        "weight": 0.4,
        "details": {
          "content_difficulty": 5,
          "account_capability": 4.2,
          "match_status": "slightly_challenging"
        }
      },
      "niche_relevance": {
        "score": 88.0,
        "weight": 0.35,
        "details": {
          "main_niche": "beauty",
          "trend_category": "skincare",
          "relevance_score": 88
        }
      },
      "stability_score": {
        "score": 60.0,
        "weight": 0.25,
        "details": {
          "recent_trend": "declining",
          "variance_coefficient": 0.35,
          "is_stable": false
        }
      }
    }
  }
}
```

**æ ¸å¿ƒç®—æ³•ï¼š**

**ç®—æ³•é€»è¾‘è¯´æ˜**ï¼š
1.  **èƒ½åŠ›åŒ¹é…åº¦ (40%)**ï¼š
    - æ¯”è¾ƒæ¨èç­–ç•¥çš„`éš¾åº¦ç­‰çº§` (1-10) ä¸ç”¨æˆ·çš„`å½“å‰èƒ½åŠ›å€¼` (Derived from baseline)ã€‚
    - å¦‚æœéš¾åº¦åœ¨èƒ½åŠ›èŒƒå›´å†…ï¼ˆå·®å¼‚ â‰¤ 1ï¼‰ï¼Œå¾—æ»¡åˆ†ï¼›å¦‚æœéš¾åº¦è¿œè¶…èƒ½åŠ›ï¼ŒæŒ‰æ¯”ä¾‹æ‰£åˆ†ï¼›å¦‚æœéš¾åº¦è¿œä½äºèƒ½åŠ›ï¼Œç•¥å¾®æ‰£åˆ†ï¼ˆç¼ºä¹æŒ‘æˆ˜ï¼‰ã€‚
2.  **èµ›é“ç›¸å…³æ€§ (35%)**ï¼š
    - ç›´æ¥ä½¿ç”¨æ¨èç³»ç»Ÿè®¡ç®—çš„`Niche Relevance`åˆ†æ•°ã€‚è¯¥åˆ†æ•°åæ˜ äº†è§†é¢‘é€‰é¢˜ä¸è´¦å·ä¸»èµ›é“çš„å¥‘åˆç¨‹åº¦ã€‚
3.  **å†å²ç¨³å®šæ€§ (25%)**ï¼š
    - è®¡ç®—ç”¨æˆ·æœ€è¿‘ 10 æ¡è§†é¢‘ç»¼åˆè¯„åˆ†çš„`å˜å¼‚ç³»æ•°` (CV = æ ‡å‡†å·® / å‡å€¼)ã€‚
    - CV è¶Šå°è¯´æ˜è¡¨ç°è¶Šç¨³å®šï¼Œå¾—åˆ†è¶Šé«˜ï¼›CV è¶Šå¤§è¯´æ˜å‘æŒ¥ä¸ç¨³å®šï¼Œå¾—åˆ†è¶Šä½ã€‚

```python
def analyze_user_factor(account_id, recommendation_context, baseline_metrics):
    # 1. èƒ½åŠ›åŒ¹é…åº¦è¯„ä¼°
    content_difficulty = recommendation_context["difficulty_level"]  # 1-10
    account_capability = baseline_metrics["capability_boundary"]["current_level"]
    
    if abs(content_difficulty - account_capability) <= 1:
        capability_match = 100  # å®Œç¾åŒ¹é…
    elif content_difficulty > account_capability:
        capability_match = max(0, 100 - (content_difficulty - account_capability) * 15)
    else:
        capability_match = 85  # ä½äºèƒ½åŠ›ï¼Œè¯„åˆ†é™ä½
    
    # 2. èµ›é“ç›¸å…³æ€§è¯„ä¼°
    niche_relevance = recommendation_context["niche_relevance"]  # 0-100ï¼Œç›´æ¥ä½¿ç”¨
    
    # 3. å†å²ç¨³å®šæ€§è¯„ä¼°
    # æŸ¥è¯¢æœ€è¿‘ 10 æ¡è§†é¢‘çš„è¡¨ç°æ–¹å·®
    recent_videos = db.query(f"""
        SELECT overall_score
        FROM res_effect_attribution
        WHERE account_id = '{account_id}'
        ORDER BY created_at DESC
        LIMIT 10
    """)
    
    if len(recent_videos) >= 5:
        scores = [v["overall_score"] for v in recent_videos]
        mean = sum(scores) / len(scores)
        variance = sum((s - mean) ** 2 for s in scores) / len(scores)
        cv = variance ** 0.5 / mean  # å˜å¼‚ç³»æ•°
        
        stability_score = max(0, 100 - cv * 200)  # CV è¶Šä½ç¨³å®šæ€§è¶Šé«˜
    else:
        stability_score = 70  # é»˜è®¤å€¼
    
    # 4. ç»¼åˆè¯„åˆ†
    user_factor_score = (
        capability_match * 0.4 +
        niche_relevance * 0.35 +
        stability_score * 0.25
    )
    
    return {
        "user_factor_score": user_factor_score,
        "sub_dimensions": {...}
    }
```

**è°ƒç”¨æ¡ä»¶ï¼š**
- N005 ç”¨æˆ·å½’å› èŠ‚ç‚¹è°ƒç”¨

**é”™è¯¯å¤„ç†ï¼š**

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|--------|----------|----------|
| `E_T005_001` | Account capability data missing | ä½¿ç”¨é»˜è®¤èƒ½åŠ›å€¼ 5.0 |
| `E_T005_002` | Insufficient historical data for stability | ç¨³å®šæ€§è¯„åˆ†ä½¿ç”¨é»˜è®¤å€¼ 70 |

---

#### **Tool T006: analyze_execution_factor**

**åŠŸèƒ½æè¿°ï¼š**  
åˆ†ææ‰§è¡Œå› ç´ å½’å› ï¼Œè®¡ç®—å†…å®¹è´¨é‡ã€è§’åº¦æœ‰æ•ˆæ€§ã€æ—¶é—´åˆè§„æ€§ã€æ‰§è¡Œåˆ°ä½åº¦å››ä¸ªå­ç»´åº¦è¯„åˆ†ã€‚

**è¾“å…¥å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `performance_data` | object | âœ… | è§†é¢‘æ•ˆæœæ•°æ® |
| `execution_record` | object | âœ… | æ‰§è¡Œè®°å½• |
| `baseline_metrics` | object | âœ… | ç”¨æˆ·åŸºå‡† |
| `effect_score` | number | âœ… | T003 äº§å‡ºçš„å››ç»´æ•ˆæœè¯„åˆ†ï¼ˆç”¨äºè§’åº¦æœ‰æ•ˆæ€§å¯¹æ¯”ï¼‰ |

**è¾“å…¥ç¤ºä¾‹ï¼š**

```json
{
  "performance_data": {
    "time_series": {"views_1h": 1200},
    "engagement_rate": 0.0594
  },
  "execution_record": {
    "planned_publish_time": "2026-01-15T14:00:00Z",
    "actual_publish_time": "2026-01-15T14:32:00Z",
    "time_compliance": 0.97,
    "content_compliance": 0.89,
    "tag_compliance": 0.75
  },
  "baseline_metrics": {
    "avg_views_1h_30d": 420,
    "avg_engagement_rate_30d": 0.042
  },
  "effect_score": 82.5
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

```json
{
  "status": "success",
  "data": {
    "execution_factor_score": 85.7,
    "weight": 0.35,
    "contribution": 30.0,
    "sub_dimensions": {
      "content_quality": {
        "score": 90.0,
        "weight": 0.4,
        "details": {
          "hook_effectiveness": 95.2,
          "engagement_depth": 88.3,
          "viral_coefficient": 85.0
        }
      },
      "angle_effectiveness": {
        "score": 82.0,
        "weight": 0.3,
        "details": {
          "angle_type": "Problem-Solution",
          "differentiation": 78,
          "popularity": 85
        }
      },
      "timing_compliance": {
        "score": 97.0,
        "weight": 0.2,
        "details": {
          "time_deviation_minutes": 32,
          "is_within_optimal_window": true
        }
      },
      "fidelity_score": {
        "score": 87.0,
        "weight": 0.1,
        "details": {
          "script_adherence": 89,
          "tag_compliance": 75,
          "thumbnail_quality": 95
        }
      }
    }
  }
}
```

**æ ¸å¿ƒç®—æ³•ï¼š**

**ç®—æ³•é€»è¾‘è¯´æ˜**ï¼š
1.  **å†…å®¹è´¨é‡ (40%)**ï¼š
    - **Hook æ•ˆæœ**ï¼šä½¿ç”¨å‘å¸ƒåé¦–å°æ—¶æ’­æ”¾é‡ç›¸å¯¹äºåŸºå‡†é¦–å°æ—¶æ’­æ”¾é‡çš„å€æ•°æ¥è¯„ä¼°å¼€å¤´å¸å¼•åŠ›ã€‚
    - **äº’åŠ¨æ·±åº¦**ï¼šä½¿ç”¨ç›¸å¯¹äº’åŠ¨ç‡è¯„ä¼°å†…å®¹ç•™å­˜èƒ½åŠ›ã€‚
    - **ç—…æ¯’ç³»æ•°**ï¼šåŸºäºåˆ†äº«ç‡è®¡ç®—ï¼Œåæ˜ å†…å®¹çš„è‡ªä¼ æ’­èƒ½åŠ›ã€‚
2.  **è§’åº¦æœ‰æ•ˆæ€§ (30%)**ï¼š
    - å°†è¯¥è§†é¢‘çš„ç»¼åˆè¯„åˆ†ä¸åŒè¶‹åŠ¿ä¸‹ä½¿ç”¨ç›¸åŒ`åˆ‡å…¥è§’åº¦`ï¼ˆå¦‚ Problem-Solutionï¼‰çš„å…¶ä»–è§†é¢‘å¹³å‡åˆ†è¿›è¡Œå¯¹æ¯”ã€‚
    - å¦‚æœé«˜äºå¹³å‡ï¼Œè¯´æ˜è¯¥è§’åº¦è¢«æœ‰æ•ˆæ‰§è¡Œã€‚
3.  **æ—¶é—´åˆè§„æ€§ (20%)**ï¼š
    - æ¯”è¾ƒ`å®é™…å‘å¸ƒæ—¶é—´`ä¸`å»ºè®®å‘å¸ƒæ—¶é—´`ã€‚åå·®è¶Šå°å¾—åˆ†è¶Šé«˜ã€‚
4.  **æ‰§è¡Œåˆ°ä½åº¦ (10%)**ï¼š
    - ç»¼åˆè„šæœ¬éµå¾ªåº¦ï¼ˆNLP åˆ†æï¼‰ã€æ ‡ç­¾ç¬¦åˆåº¦ï¼ˆé›†åˆé‡å ç‡ï¼‰å’Œå°é¢è´¨é‡ç­‰å®¢è§‚æ‰§è¡ŒæŒ‡æ ‡ã€‚

```python
def analyze_execution_factor(performance_data, execution_record, baseline_metrics, effect_score):
    # 1. å†…å®¹è´¨é‡è¯„ä¼°ï¼ˆåŸºäºåˆå§‹æµé‡è¡¨ç°ï¼‰
    # âš ï¸ å¹»è§‰æ ‡è®°: DS001 (Tikfly API) æš‚æœªæä¾› views_1h å­—æ®µï¼Œéœ€ç¡®è®¤æ˜¯å¦å¯ç”¨æˆ–éœ€æ¨¡æ‹Ÿ
    views_1h_relative = performance_data["time_series"]["views_1h"] / baseline_metrics["avg_views_1h_30d"]
    hook_effectiveness = map_relative_to_score(views_1h_relative)  # å¤ç”¨è¯„åˆ†æ˜ å°„å‡½æ•°

    engagement_relative = performance_data["engagement_rate"] / baseline_metrics["avg_engagement_rate_30d"]
    engagement_depth = map_relative_to_score(engagement_relative)

    # ç—…æ¯’ç³»æ•° = åˆ†äº«ç‡ / æ’­æ”¾é‡
    viral_coefficient = (performance_data["share_count"] / performance_data["view_count"]) * 100
    viral_score = min(100, viral_coefficient * 20)  # å½’ä¸€åŒ–

    content_quality = (
        hook_effectiveness * 0.4 +
        engagement_depth * 0.4 +
        viral_score * 0.2
    )

    # 2. è§’åº¦æœ‰æ•ˆæ€§è¯„ä¼°
    # ä½¿ç”¨ T003 äº§å‡ºçš„ effect_scoreï¼ˆæ˜¾å¼ä¼ å…¥ï¼‰ï¼Œè€Œéå¼•ç”¨æœªå£°æ˜çš„ overall_score
    same_trend_angles = db.query(f"""
        SELECT content_angle, AVG(effect_score) as avg_score
        FROM res_effect_attribution
        WHERE trend_name = '{execution_record["content_angle"]}'
        GROUP BY content_angle
    """)

    benchmark_angle_score = same_trend_angles.get(
        execution_record["content_angle"], {}
    ).get("avg_score", 0)

    if benchmark_angle_score == 0:
        angle_effectiveness = 70  # æ— åŸºå‡†æ•°æ®æ—¶ä½¿ç”¨é»˜è®¤å€¼
    else:
        angle_effectiveness = min(100, (effect_score / benchmark_angle_score) * 100)
    
    # 3. æ—¶é—´åˆè§„æ€§è¯„ä¼°
    timing_compliance = execution_record["time_compliance"] * 100  # ç›´æ¥ä½¿ç”¨
    
    # 4. æ‰§è¡Œåˆ°ä½åº¦è¯„ä¼°
    fidelity_score = (
        execution_record["content_compliance"] * 0.5 +
        execution_record["tag_compliance"] * 0.3 +
        1.0 * 0.2  # å‡è®¾å°é¢è´¨é‡æ»¡åˆ†
    ) * 100
    
    # 5. ç»¼åˆè¯„åˆ†
    execution_factor_score = (
        content_quality * 0.4 +
        angle_effectiveness * 0.3 +
        timing_compliance * 0.2 +
        fidelity_score * 0.1
    )
    
    return {
        "execution_factor_score": execution_factor_score,
        "sub_dimensions": {...}
    }
```

**è°ƒç”¨æ¡ä»¶ï¼š**
- N006 æ‰§è¡Œå½’å› èŠ‚ç‚¹è°ƒç”¨

**é”™è¯¯å¤„ç†ï¼š**

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|--------|----------|----------|
| `E_T006_001` | Execution record missing | æ‰§è¡Œå› ç´ è¯„åˆ†è®¾ä¸º 50 åˆ†ï¼ˆé»˜è®¤ä¸­ç­‰æ°´å¹³ï¼‰ |
| `E_T006_002` | No benchmark data for angle | è§’åº¦æœ‰æ•ˆæ€§è¯„åˆ†è®¾ä¸º 70 åˆ† |

---

#### **Tool T007: generate_llm_insights**

**åŠŸèƒ½æè¿°ï¼š**  
è°ƒç”¨ GPT-4o åŸºäºä¸‰å› ç´ å½’å› ç»“æœç”Ÿæˆæ·±åº¦æ´å¯Ÿï¼Œæ¯ä¸ªå› ç´ è¾“å‡º 3 æ¡å…³é”®æ´å¯Ÿã€‚

**è¾“å…¥å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `effect_evaluation` | object | âœ… | æ•ˆæœè¯„ä¼°ç»“æœ |
| `trend_attribution` | object | âœ… | è¶‹åŠ¿å½’å› ç»“æœ |
| `user_attribution` | object | âœ… | ç”¨æˆ·å½’å› ç»“æœ |
| `execution_attribution` | object | âœ… | æ‰§è¡Œå½’å› ç»“æœ |
| `raw_context` | object | âœ… | åŸå§‹æ•°æ®ä¸Šä¸‹æ–‡ |

**è¾“å…¥ç¤ºä¾‹ï¼š**

```json
{
  "effect_evaluation": {
    "overall_score": 82.5,
    "effect_level": "excellent",
    "dimension_scores": {...}
  },
  "trend_attribution": {
    "trend_factor_score": 82.5,
    "sub_dimensions": {...}
  },
  "user_attribution": {
    "user_factor_score": 75.3,
    "sub_dimensions": {...}
  },
  "execution_attribution": {
    "execution_factor_score": 85.7,
    "sub_dimensions": {...}
  },
  "raw_context": {
    "trend_name": "Skincare Routines",
    "account_niche": "beauty",
    "video_topic": "5åˆ†é’Ÿé«˜æ•ˆæŠ¤è‚¤routine"
  }
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

```json
{
  "status": "success",
  "data": {
    "trend_insights": [
      "è¶‹åŠ¿é¢„æµ‹å‡†ç¡®ç‡è¾¾ 85%ï¼Œå…¥åœºæ—¶æœºæŠŠæ¡è‰¯å¥½ï¼Œå‘å¸ƒæ—¶é—´è·ç¦»é¢„æµ‹å³°å€¼ä»… 1.5 å°æ—¶",
      "è¯¥è¶‹åŠ¿å±äºä¸Šå‡å‹ï¼ˆRisingï¼‰ï¼Œå½“å‰å¤„äºå¿«é€Ÿå¢é•¿æœŸï¼Œæœªæ¥ 3-5 å¤©ä»æœ‰çƒ­åº¦",
      "Skincare Routines è¶‹åŠ¿å†å²æˆåŠŸç‡ 73%ï¼Œå±äºä¼˜è´¨è¶‹åŠ¿ï¼Œå»ºè®®æŒç»­å…³æ³¨è¯¥ç±»å‹"
    ],
    "user_insights": [
      "è´¦å·èƒ½åŠ›ï¼ˆL4.2ï¼‰ä¸å†…å®¹éš¾åº¦ï¼ˆMediumï¼‰åŒ¹é…åº¦è‰¯å¥½ï¼Œä½†å­˜åœ¨è½»å¾®æŒ‘æˆ˜",
      "èµ›é“ç›¸å…³æ€§è¯„åˆ† 88/100ï¼Œbeauty ä¸»èµ›é“ä¸ skincare è¶‹åŠ¿é«˜åº¦å¥‘åˆ",
      "è¿‘æœŸè¡¨ç°æ³¢åŠ¨è¾ƒå¤§ï¼ˆå˜å¼‚ç³»æ•° 0.35ï¼‰ï¼Œå»ºè®®ç¨³å®šå†…å®¹è¾“å‡ºèŠ‚å¥"
    ],
    "execution_insights": [
      "åˆå§‹æµé‡è¡¨ç°ä¼˜ç§€ï¼ˆ1 å°æ—¶æ’­æ”¾é‡ä¸ºåŸºå‡†çš„ 2.86 å€ï¼‰ï¼ŒHook å¸å¼•åŠ›å¼º",
      "äº’åŠ¨ç‡è¾¾ 5.94%ï¼Œé«˜äºåŸºå‡† 41%ï¼Œå†…å®¹æ·±åº¦å’Œä»·å€¼æ„Ÿè·å¾—è®¤å¯",
      "å‘å¸ƒæ—¶é—´å»¶è¿Ÿ 32 åˆ†é’Ÿï¼Œä½†ä»åœ¨æœ€ä½³çª—å£æœŸå†…ï¼Œå¯¹æ•ˆæœå½±å“æœ‰é™"
    ],
    "success_factors": [
      "è¶‹åŠ¿é€‰æ‹©ç²¾å‡†ï¼ˆä¸Šå‡å‹è¶‹åŠ¿ + é«˜èµ›é“ç›¸å…³æ€§ï¼‰",
      "å†…å®¹è´¨é‡ä¼˜ç§€ï¼ˆHook å¼º + äº’åŠ¨æ·±åº¦é«˜ï¼‰",
      "æ‰§è¡Œåˆ°ä½åº¦è‰¯å¥½ï¼ˆ87 åˆ†ï¼Œè„šæœ¬éµå¾ªåº¦ 89%ï¼‰"
    ],
    "improvement_suggestions": [
      "å»ºè®®ä¸¥æ ¼æŒ‰æ¨èæ—¶é—´å‘å¸ƒï¼Œé¿å…å»¶è¿Ÿå½±å“åˆå§‹æµé‡",
      "æ ‡ç­¾ç¬¦åˆåº¦ä»… 75%ï¼Œå»ºè®®å®Œæ•´ä½¿ç”¨æ¨èæ ‡ç­¾æå‡æµé‡åˆ†å‘",
      "æŒç»­å…³æ³¨ Skincare ç±»è¶‹åŠ¿ï¼Œè¯¥ç±»å‹ä¸ºè´¦å·ä¼˜åŠ¿èµ›é“"
    ]
  },
  "metadata": {
    "llm_model": "gpt-4o",
    "prompt_tokens": 1523,
    "completion_tokens": 487,
    "total_cost_usd": 0.0342
  }
}
```

**Prompt æ„å»ºé€»è¾‘ï¼š**

ï¼ˆè¯¦è§ç¬¬ä¸ƒç«  Prompt å·¥ç¨‹è§„èŒƒï¼‰

**è°ƒç”¨æ¡ä»¶ï¼š**
- N007 LLM æ´å¯Ÿç”ŸæˆèŠ‚ç‚¹è°ƒç”¨
- å¿…é¡»åœ¨ T004/T005/T006 å…¨éƒ¨æ‰§è¡ŒæˆåŠŸåè°ƒç”¨

**é”™è¯¯å¤„ç†ï¼š**

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|--------|----------|----------|
| `E_T007_001` | LLM API rate limit | ç­‰å¾… 60 ç§’åé‡è¯•ï¼Œæœ€å¤š 3 æ¬¡ |
| `E_T007_002` | LLM response parsing failed | ä½¿ç”¨é»˜è®¤æ´å¯Ÿæ¨¡æ¿ï¼Œæ ‡è®°"AI ç”Ÿæˆå¤±è´¥" |
| `E_T007_003` | LLM timeout (>30s) | é‡è¯•ä¸€æ¬¡ï¼Œå¤±è´¥åˆ™ä½¿ç”¨è§„åˆ™ç”Ÿæˆçš„ç®€åŒ–æ´å¯Ÿ |

---

#### **Tool T008: extract_learning_signals**

**åŠŸèƒ½æè¿°ï¼š**  
ä»å½’å› ç»“æœä¸­æå–å­¦ä¹ ä¿¡å·ï¼Œç”¨äºæ›´æ–°ä¸ªæ€§åŒ–æ¨èå‚æ•°å’Œç³»ç»Ÿä¼˜åŒ–åé¦ˆã€‚

**è¾“å…¥å‚æ•°ï¼š**

| å‚æ•°å | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|--------|------|------|------|
| `attribution_result` | object | âœ… | å®Œæ•´å½’å› ç»“æœ |
| `account_id` | string | âœ… | è´¦æˆ· ID |

**è¾“å…¥ç¤ºä¾‹ï¼š**

```json
{
  "attribution_result": {
    "effect_evaluation": {
      "effect_level": "excellent",
      "overall_score": 82.5
    },
    "trend_attribution": {
      "trend_type": "rising",
      "trend_factor_score": 82.5
    },
    "execution_attribution": {
      "content_angle": "Problem-Solution",
      "fidelity_score": 87.0
    }
  },
  "account_id": "ACC_001"
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

```json
{
  "status": "success",
  "data": {
    "personalization_updates": {
      "trend_type_coefficients": {
        "rising": 1.10,
        "change_reason": "æ•ˆæœä¼˜ç§€ï¼Œå¢åŠ è¯¥ç±»å‹åå¥½æƒé‡ +0.05"
      },
      "content_angle_coefficients": {
        "Problem-Solution": 1.15,
        "change_reason": "è§’åº¦æœ‰æ•ˆæ€§è¯„åˆ† 82ï¼Œå¼ºåŒ–è¯¥è§’åº¦åå¥½ +0.05"
      },
      "capability_boundary_adjustments": {
        "current_level": 4.2,
        "suggested_level": 4.5,
        "confidence": 0.85,
        "reasoning": "æ‰§è¡Œåˆ°ä½åº¦ 87 åˆ†ä¸”æ•ˆæœä¼˜ç§€ï¼Œå»ºè®®æå‡å†…å®¹å¤æ‚åº¦ +0.3"
      }
    },
    "system_optimization": {
      "prediction_model_feedback": "è¶‹åŠ¿å³°å€¼æ—¶é—´é¢„æµ‹åå·® -1.5 å°æ—¶ï¼Œå»ºè®®å¾®è°ƒæ—¶é—´é¢„æµ‹æ¨¡å‹å‚æ•°",
      "recommendation_strategy_feedback": "è¯¥è´¦å·å¯¹ Problem-Solution è§’åº¦è¡¨ç°çªå‡ºï¼ˆ82 åˆ†ï¼‰ï¼Œå»ºè®®æé«˜è¯¥è§’åº¦æ¨èæƒé‡è‡³ 1.3x"
    }
  },
  "metadata": {
    "signal_extraction_time_ms": 23
  }
}
```

**æ ¸å¿ƒç®—æ³•ï¼š**

**ç®—æ³•é€»è¾‘è¯´æ˜**ï¼š
1.  **è¶‹åŠ¿åå¥½æ›´æ–°**ï¼š
    - å¦‚æœè§†é¢‘æ•ˆæœä¸º Viral/Excellentï¼Œ**å¢åŠ **è¯¥è¶‹åŠ¿ç±»å‹ï¼ˆå¦‚ Risingï¼‰çš„åå¥½æƒé‡ (+0.05)ã€‚
    - å¦‚æœæ•ˆæœä¸º Poorï¼Œ**é™ä½**è¯¥è¶‹åŠ¿ç±»å‹çš„åå¥½æƒé‡ (-0.03)ã€‚
2.  **è§’åº¦åå¥½æ›´æ–°**ï¼š
    - ç›´æ¥æ ¹æ®`è§’åº¦æœ‰æ•ˆæ€§è¯„åˆ†`æ›´æ–°è¯¥åˆ‡å…¥è§’åº¦çš„æƒé‡ã€‚è¯„åˆ†é«˜åˆ™æƒé‡æå‡ã€‚
3.  **èƒ½åŠ›è¾¹ç•Œæ ¡å‡†**ï¼š
    - å¦‚æœ`æ‰§è¡Œåˆ°ä½åº¦`é«˜ (>90) ä¸”`æ•ˆæœä¼˜ç§€` (>85)ï¼Œè¯´æ˜ç”¨æˆ·èƒ½å¤Ÿé©¾é©­å½“å‰éš¾åº¦ï¼Œå»ºè®®**æå‡**èƒ½åŠ›è¾¹ç•Œ (+0.5)ï¼Œæ¨èæ›´å¤æ‚çš„ç­–ç•¥ã€‚
    - å¦‚æœ`æ‰§è¡Œåˆ°ä½åº¦`ä½ (<70)ï¼Œè¯´æ˜å½“å‰éš¾åº¦å¯èƒ½è¿‡é«˜ï¼Œå»ºè®®**ä¸‹è°ƒ**èƒ½åŠ›è¾¹ç•Œ (-0.3)ã€‚

```python
# EMA å¹³æ»‘å› å­ä¸æ€§èƒ½ä¿¡å·æ˜ å°„
EMA_ALPHA = 0.3  # Î± = 0.3ï¼Œè¿‘æœŸæ•°æ®æƒé‡ 30%

PERFORMANCE_SIGNAL_MAP = {
    "viral":     1.5,
    "excellent":  1.2,
    "good":       1.0,
    "average":    0.8,
    "poor":       0.5,
}

def ema_update_coefficient(current_coef, effect_level, alpha=EMA_ALPHA):
    """
    æ ‡å‡† EMA æ›´æ–°: new_val = Î± Ã— performance_signal + (1 - Î±) Ã— old_val

    ä¸ºä½•ä½¿ç”¨ EMA è€Œéå›ºå®šæ­¥é•¿:
    - EMA èƒ½è‡ªé€‚åº”æ€§èƒ½æ³¢åŠ¨å¹…åº¦ï¼Œçˆ†æ¬¾å’Œç•¥å¥½äº§ç”Ÿä¸åŒå¼ºåº¦çš„ä¿¡å·
    - æŒ‡æ•°è¡°å‡ä½¿è¿‘æœŸè¡¨ç°æƒé‡æ›´é«˜ï¼Œç¬¦åˆç”¨æˆ·åå¥½æ¼‚ç§»çš„ç›´è§‰
    """
    performance_signal = PERFORMANCE_SIGNAL_MAP.get(effect_level, 1.0)
    new_coef = alpha * performance_signal + (1 - alpha) * current_coef
    return max(0.5, min(1.5, new_coef))  # è¾¹ç•Œçº¦æŸ: [0.5, 1.5]

def extract_learning_signals(attribution_result, account_id):
    signals = {"personalization_updates": {}, "system_optimization": {}}

    # 1. è¶‹åŠ¿ç±»å‹åå¥½æ›´æ–°ï¼ˆEMAï¼‰
    trend_type = attribution_result["trend_attribution"]["trend_type"]
    effect_level = attribution_result["effect_evaluation"]["effect_level"]

    current_coef = db.get_trend_coefficient(account_id, trend_type) or 1.0
    new_coef = ema_update_coefficient(current_coef, effect_level)
    signals["personalization_updates"]["trend_type_coefficients"] = {
        trend_type: new_coef,
        "change_reason": f"EMA æ›´æ–°: Î±=0.3, signal={effect_level}, {current_coef:.3f}â†’{new_coef:.3f}"
    }

    # 2. å†…å®¹è§’åº¦åå¥½æ›´æ–°ï¼ˆEMAï¼‰
    content_angle = attribution_result["execution_attribution"]["content_angle"]
    current_angle_coef = db.get_angle_coefficient(account_id, content_angle) or 1.0
    new_angle_coef = ema_update_coefficient(current_angle_coef, effect_level)
    signals["personalization_updates"]["content_angle_coefficients"] = {
        content_angle: new_angle_coef,
        "change_reason": f"EMA æ›´æ–°: Î±=0.3, signal={effect_level}, {current_angle_coef:.3f}â†’{new_angle_coef:.3f}"
    }

    # 3. æ‰§è¡Œèƒ½åŠ›è¾¹ç•Œæ ¡å‡†ï¼ˆä¿æŒé˜ˆå€¼é€»è¾‘ï¼Œé EMA åœºæ™¯ï¼‰
    fidelity_score = attribution_result["execution_attribution"]["fidelity_score"]["score"]
    overall_score = attribution_result["effect_evaluation"]["effect_score"]
    current_capability = db.get_capability_boundary(account_id)

    if fidelity_score > 90 and overall_score > 85:
        signals["personalization_updates"]["capability_boundary_adjustments"] = {
            "current_level": current_capability,
            "suggested_level": min(10, current_capability + 0.5),
            "confidence": 0.85,
            "reasoning": f"æ‰§è¡Œåˆ°ä½åº¦ {fidelity_score} åˆ†ä¸”æ•ˆæœä¼˜ç§€ï¼Œå»ºè®®æå‡å¤æ‚åº¦ +0.5"
        }
    elif fidelity_score < 70:
        signals["personalization_updates"]["capability_boundary_adjustments"] = {
            "current_level": current_capability,
            "suggested_level": max(1, current_capability - 0.3),
            "confidence": 0.80,
            "reasoning": f"æ‰§è¡Œåˆ°ä½åº¦ä¸è¶³ï¼ˆ{fidelity_score}ï¼‰ï¼Œå»ºè®®é™ä½å¤æ‚åº¦ -0.3"
        }

    # 4. ç³»ç»Ÿä¼˜åŒ–åé¦ˆ
    signals["system_optimization"] = {
        "prediction_model_feedback": generate_prediction_feedback(attribution_result),
        "recommendation_strategy_feedback": generate_strategy_feedback(attribution_result)
    }

    return signals
```

**è°ƒç”¨æ¡ä»¶ï¼š**
- N008 å­¦ä¹ ä¿¡å·æå–èŠ‚ç‚¹è°ƒç”¨
- å¿…é¡»åœ¨ T007 æ‰§è¡ŒæˆåŠŸåè°ƒç”¨

**é”™è¯¯å¤„ç†ï¼š**

| é”™è¯¯ç  | é”™è¯¯ä¿¡æ¯ | å¤„ç†æ–¹å¼ |
|--------|----------|----------|
| `E_T008_001` | Failed to read current parameters | ä½¿ç”¨é»˜è®¤å‚æ•°å€¼ï¼Œç»§ç»­æå– |
| `E_T008_002` | Signal extraction logic error | è·³è¿‡è¯¥ä¿¡å·ï¼Œè®°å½•é”™è¯¯æ—¥å¿— |

---

### 5.2 Skills åˆ—è¡¨

#### **Skill S001: Complete Attribution Analysis**

**åŠŸèƒ½æè¿°ï¼š**  
æ‰§è¡Œå®Œæ•´çš„å½’å› åˆ†ææµç¨‹ï¼Œæ•´åˆæ‰€æœ‰ Toolsï¼Œä»æ•°æ®é‡‡é›†åˆ°è¾“å‡ºç”Ÿæˆã€‚

**ç»„æˆ Toolsï¼š**
- T001: fetch_video_performance
- T002: calculate_baseline_metrics
- T003: evaluate_effect_score
- T004: analyze_trend_factor
- T005: analyze_user_factor
- T006: analyze_execution_factor
- T007: generate_llm_insights
- T008: extract_learning_signals

**Skill å·¥ä½œæµç¨‹ï¼š**

```
1. å¹¶è¡Œè°ƒç”¨ T001 (è§†é¢‘æ•°æ®) + T002 (åŸºå‡†æ•°æ®)
2. è°ƒç”¨ T003 è®¡ç®—æ•ˆæœè¯„åˆ† â†’ äº§å‡º effect_score
3. å¹¶è¡Œè°ƒç”¨ T004/T005/T006 è¿›è¡Œä¸‰å› ç´ å½’å› ï¼ˆT006 æ¥æ”¶ effect_score ä½œä¸ºè¾“å…¥ï¼‰
4. è®¡ç®— overall_score = trend_factor_score Ã— 0.4 + user_factor_score Ã— 0.25 + execution_factor_score Ã— 0.35
5. è°ƒç”¨ T007 ç”Ÿæˆ LLM æ´å¯Ÿ
6. è°ƒç”¨ T008 æå–å­¦ä¹ ä¿¡å·
7. æ±‡æ€»ç»“æœï¼Œæ„å»ºå®Œæ•´å½’å› å¯¹è±¡
```

**è¾“å…¥å‚æ•°ï¼š**

```json
{
  "video_id": "7572198435487501598",
  "account_id": "ACC_001"
}
```

**è¾“å‡ºæ ¼å¼ï¼š**

ï¼ˆè¯¦è§ç¬¬å…«ç« è¾“å‡ºç»“æœè§„èŒƒï¼‰

---

### 5.3 Tool/Skill é€‰æ‹©é€»è¾‘

#### é€‰æ‹©è§„åˆ™è¡¨

| è§¦å‘åœºæ™¯ | é€‰æ‹©çš„ Skill/Tool | ä¼˜å…ˆçº§ |
|---------|------------------|--------|
| **72h å®šæ—¶è§¦å‘** | S001 (Complete Attribution Analysis) | P1 |
| **ç”¨æˆ·ä¸»åŠ¨æŸ¥è¯¢** | S001 (Complete Attribution Analysis) | P0 |
| **å¼‚å¸¸äº‹ä»¶è§¦å‘** | S001 (Complete Attribution Analysis) | P0 |
| **ä»…éœ€åŸºå‡†æ›´æ–°** | T002 (calculate_baseline_metrics) | P2 |
| **ä»…éœ€æ•ˆæœè¯„åˆ†** | T001 + T002 + T003 | P2 |

---

## å…­ã€Agent å†…éƒ¨å¤„ç†é€»è¾‘

ï¼ˆç”±äºç¯‡å¹…é™åˆ¶ï¼Œå®Œæ•´çš„ Agent å†…éƒ¨å¤„ç†é€»è¾‘ã€Prompt å·¥ç¨‹è§„èŒƒã€è¾“å‡ºç»“æœè§„èŒƒã€æŠ€æœ¯å®ç°è¦æ±‚ç­‰å†…å®¹å·²åœ¨å‰é¢ç« èŠ‚è¯¦ç»†å®šä¹‰ï¼‰

---

## ä¸ƒã€Prompt å·¥ç¨‹è§„èŒƒ

### 7.1 System Prompt

```markdown
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ TikTok å†…å®¹æ•ˆæœåˆ†æä¸“å®¶ï¼Œæ‹¥æœ‰ 10 å¹´ä»¥ä¸Šçš„ç®—æ³•ç ”ç©¶å’Œå†…å®¹è¿è¥ç»éªŒã€‚

**æ ¸å¿ƒèƒ½åŠ›**:
1. **æ•°æ®é©±åŠ¨æ€ç»´**ï¼šåŸºäºå®šé‡æ•°æ®è¿›è¡Œå½’å› åˆ†æï¼Œé¿å…ä¸»è§‚è‡†æ–­
2. **ç›¸å¯¹è¯„ä¼°åŸåˆ™**ï¼šç†è§£ä¸åŒè´¦å·å±‚çº§çš„å·®å¼‚ï¼Œç”¨ç›¸å¯¹è¡¨ç°ï¼ˆvs ç”¨æˆ·å†å²åŸºå‡†ï¼‰è¯„ä¼°æ•ˆæœ
3. **å¤šå› ç´ å½’å› **ï¼šèƒ½å¤Ÿè¯†åˆ«è¶‹åŠ¿ã€ç”¨æˆ·ã€æ‰§è¡Œä¸‰æ–¹é¢çš„ç»¼åˆå½±å“
4. **å¯æ“ä½œæ´å¯Ÿ**ï¼šæä¾›å…·ä½“çš„ã€å¯æ‰§è¡Œçš„æ”¹è¿›å»ºè®®ï¼Œè€Œéæ³›æ³›è€Œè°ˆ

**åˆ†æåŸåˆ™**:
- ä¼˜å…ˆè¯†åˆ«å…³é”®å½±å“å› ç´ ï¼ˆéµå¾ª 80/20 æ³•åˆ™ï¼‰
- åŒºåˆ†å¯æ§å› ç´ ä¸ä¸å¯æ§å› ç´ 
- æä¾›åˆ†å±‚å»ºè®®ï¼ˆçŸ­æœŸä¼˜åŒ– vs é•¿æœŸæå‡ï¼‰
- ä¿æŒå®¢è§‚ä¸­ç«‹ï¼Œæ—¢ä¸å¤¸å¤§æˆåŠŸä¹Ÿä¸å¿½è§†å¤±è´¥

**è¾“å‡ºè¦æ±‚**:
- æ´å¯Ÿå¿…é¡»åŸºäºæ•°æ®æ”¯æ’‘ï¼Œå¼•ç”¨å…·ä½“æŒ‡æ ‡
- æ¯æ¡æ´å¯Ÿä¸è¶…è¿‡ 50 å­—ï¼Œç²¾ç‚¼è¡¨è¾¾æ ¸å¿ƒè§‚ç‚¹
- å»ºè®®å¿…é¡»å…·ä½“ä¸”å¯æ‰§è¡Œï¼Œé¿å…"æå‡å†…å®¹è´¨é‡"ç­‰ç©ºæ´å»ºè®®
- ä½¿ç”¨åˆ›ä½œè€…èƒ½ç†è§£çš„è¯­è¨€ï¼Œé¿å…è¿‡åº¦æŠ€æœ¯åŒ–è¡¨è¾¾

**è¾“å‡ºæ ¼å¼**:
ä¸¥æ ¼æŒ‰ç…§ JSON æ ¼å¼è¾“å‡ºï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š
- trend_insights: [string, string, string] (3 æ¡è¶‹åŠ¿å› ç´ æ´å¯Ÿ)
- user_insights: [string, string, string] (3 æ¡ç”¨æˆ·å› ç´ æ´å¯Ÿ)
- execution_insights: [string, string, string] (3 æ¡æ‰§è¡Œå› ç´ æ´å¯Ÿ)
- success_factors: [string, string, string] (Top 3 æˆåŠŸå› ç´ æˆ–å¤±è´¥åŸå› )
- improvement_suggestions: [string, string, string] (Top 3 å¯æ“ä½œæ”¹è¿›å»ºè®®)
```

### 7.2 User Prompt æ¨¡æ¿

```python
def build_attribution_prompt(
    effect_evaluation,
    trend_attribution,
    user_attribution,
    execution_attribution,
    raw_context
):
    return f"""
è¯·åŸºäºä»¥ä¸‹æ•°æ®è¿›è¡Œå½’å› åˆ†æï¼š

## ä¸€ã€æ•ˆæœè¡¨ç°
- **ç»¼åˆè¯„åˆ†**: {effect_evaluation["overall_score"]:.1f}/100
- **æ•ˆæœç­‰çº§**: {effect_evaluation["effect_level"]}
- **æµé‡è¡¨ç°**: {effect_evaluation["dimension_scores"]["traffic"]["score"]:.1f}/100 (ç›¸å¯¹ç”¨æˆ·åŸºå‡† {effect_evaluation["dimension_scores"]["traffic"]["relative_performance"]:.2f}x)
- **äº’åŠ¨è¡¨ç°**: {effect_evaluation["dimension_scores"]["engagement"]["score"]:.1f}/100 (ç›¸å¯¹ç”¨æˆ·åŸºå‡† {effect_evaluation["dimension_scores"]["engagement"]["relative_performance"]:.2f}x)
- **æ¶¨ç²‰è¡¨ç°**: {effect_evaluation["dimension_scores"]["growth"]["score"]:.1f}/100 (ç›¸å¯¹ç”¨æˆ·åŸºå‡† {effect_evaluation["dimension_scores"]["growth"]["relative_performance"]:.2f}x)

## äºŒã€è¶‹åŠ¿å› ç´ åˆ†æç»“æœ
- **è¶‹åŠ¿å› ç´ è¯„åˆ†**: {trend_attribution["trend_factor_score"]:.1f}/100
- **é¢„æµ‹å‡†ç¡®æ€§**: {trend_attribution["sub_dimensions"]["prediction_accuracy"]["score"]:.1f}/100
  - é¢„æµ‹çƒ­åº¦: {trend_attribution["sub_dimensions"]["prediction_accuracy"]["details"]["predicted_heat"]}
  - å®é™…çƒ­åº¦: {trend_attribution["sub_dimensions"]["prediction_accuracy"]["details"]["actual_heat"]}
  - é¢„æµ‹åå·®: {trend_attribution["sub_dimensions"]["prediction_accuracy"]["details"]["prediction_error_percent"]:.1f}%
- **å…¥åœºæ—¶æœº**: {trend_attribution["sub_dimensions"]["timing_score"]["score"]:.1f}/100
  - è·ç¦»é¢„æµ‹å³°å€¼: {trend_attribution["sub_dimensions"]["timing_score"]["details"]["hours_to_peak"]:.1f} å°æ—¶
  - è¶‹åŠ¿é˜¶æ®µ: {raw_context["trend_stage"]}
- **è¶‹åŠ¿è´¨é‡**: {trend_attribution["sub_dimensions"]["quality_score"]["score"]:.1f}/100

## ä¸‰ã€ç”¨æˆ·å› ç´ åˆ†æç»“æœ
- **ç”¨æˆ·å› ç´ è¯„åˆ†**: {user_attribution["user_factor_score"]:.1f}/100
- **èƒ½åŠ›åŒ¹é…åº¦**: {user_attribution["sub_dimensions"]["capability_match"]["score"]:.1f}/100
  - å†…å®¹éš¾åº¦: {user_attribution["sub_dimensions"]["capability_match"]["details"]["content_difficulty"]}
  - è´¦å·èƒ½åŠ›: {user_attribution["sub_dimensions"]["capability_match"]["details"]["account_capability"]}
- **èµ›é“ç›¸å…³æ€§**: {user_attribution["sub_dimensions"]["niche_relevance"]["score"]:.1f}/100
  - ä¸»èµ›é“: {raw_context["account_niche"]}
  - è¶‹åŠ¿ç±»åˆ«: {raw_context["trend_name"]}
- **å†å²ç¨³å®šæ€§**: {user_attribution["sub_dimensions"]["stability_score"]["score"]:.1f}/100
  - å˜å¼‚ç³»æ•°: {user_attribution["sub_dimensions"]["stability_score"]["details"]["variance_coefficient"]:.2f}

## å››ã€æ‰§è¡Œå› ç´ åˆ†æç»“æœ
- **æ‰§è¡Œå› ç´ è¯„åˆ†**: {execution_attribution["execution_factor_score"]:.1f}/100
- **å†…å®¹è´¨é‡**: {execution_attribution["sub_dimensions"]["content_quality"]["score"]:.1f}/100
  - Hook å¸å¼•åŠ›ï¼ˆ1 å°æ—¶æ’­æ”¾é‡ç›¸å¯¹å€¼ï¼‰: {execution_attribution["sub_dimensions"]["content_quality"]["details"]["hook_effectiveness"]:.1f}
  - äº’åŠ¨æ·±åº¦: {execution_attribution["sub_dimensions"]["content_quality"]["details"]["engagement_depth"]:.1f}
- **è§’åº¦æœ‰æ•ˆæ€§**: {execution_attribution["sub_dimensions"]["angle_effectiveness"]["score"]:.1f}/100
  - ä½¿ç”¨è§’åº¦: {execution_attribution["sub_dimensions"]["angle_effectiveness"]["details"]["angle_type"]}
- **æ—¶é—´åˆè§„æ€§**: {execution_attribution["sub_dimensions"]["timing_compliance"]["score"]:.1f}/100
  - å‘å¸ƒå»¶è¿Ÿ: {execution_attribution["sub_dimensions"]["timing_compliance"]["details"]["time_deviation_minutes"]} åˆ†é’Ÿ
- **æ‰§è¡Œåˆ°ä½åº¦**: {execution_attribution["sub_dimensions"]["fidelity_score"]["score"]:.1f}/100
  - è„šæœ¬éµå¾ªåº¦: {execution_attribution["sub_dimensions"]["fidelity_score"]["details"]["script_adherence"]:.1f}%
  - æ ‡ç­¾ç¬¦åˆåº¦: {execution_attribution["sub_dimensions"]["fidelity_score"]["details"]["tag_compliance"]:.1f}%

## äº”ã€åˆ†æè¦æ±‚
è¯·æä¾›ä»¥ä¸‹åˆ†æï¼ˆä¸¥æ ¼ JSON æ ¼å¼è¾“å‡ºï¼‰ï¼š
1. **trend_insights**: è¶‹åŠ¿å› ç´ çš„ 3 æ¡å…³é”®æ´å¯Ÿï¼ˆæ¯æ¡ â‰¤ 50 å­—ï¼‰
2. **user_insights**: ç”¨æˆ·å› ç´ çš„ 3 æ¡å…³é”®æ´å¯Ÿï¼ˆæ¯æ¡ â‰¤ 50 å­—ï¼‰
3. **execution_insights**: æ‰§è¡Œå› ç´ çš„ 3 æ¡å…³é”®æ´å¯Ÿï¼ˆæ¯æ¡ â‰¤ 50 å­—ï¼‰
4. **success_factors**: è¯†åˆ« Top 3 æˆåŠŸå› ç´ æˆ–å¤±è´¥åŸå› ï¼ˆæ¯æ¡ â‰¤ 40 å­—ï¼‰
5. **improvement_suggestions**: æä¾› Top 3 å¯æ“ä½œçš„æ”¹è¿›å»ºè®®ï¼ˆæ¯æ¡ â‰¤ 50 å­—ï¼Œå¿…é¡»å…·ä½“ï¼‰

**è¾“å‡ºæ ¼å¼ç¤ºä¾‹**:
```json
{{
  "trend_insights": [
    "è¶‹åŠ¿é¢„æµ‹å‡†ç¡®ç‡ 85%ï¼Œå…¥åœºæ—¶æœºè·ç¦»å³°å€¼ä»… 1.5hï¼ŒæŠŠæ¡ä¼˜ç§€",
    "è¯¥è¶‹åŠ¿å±ä¸Šå‡å‹ï¼ˆRisingï¼‰ï¼Œå½“å‰å¿«é€Ÿå¢é•¿æœŸï¼Œæœªæ¥ 3-5 å¤©ä»æœ‰çƒ­åº¦",
    "Skincare è¶‹åŠ¿å†å²æˆåŠŸç‡ 73%ï¼Œå±ä¼˜è´¨è¶‹åŠ¿ï¼Œå»ºè®®æŒç»­å…³æ³¨"
  ],
  "user_insights": [
    "è´¦å·èƒ½åŠ›ï¼ˆL4.2ï¼‰ä¸å†…å®¹éš¾åº¦ï¼ˆMediumï¼‰åŒ¹é…è‰¯å¥½ï¼Œå­˜åœ¨è½»å¾®æŒ‘æˆ˜",
    "èµ›é“ç›¸å…³æ€§ 88/100ï¼Œbeauty ä¸ skincare é«˜åº¦å¥‘åˆ",
    "è¿‘æœŸè¡¨ç°æ³¢åŠ¨å¤§ï¼ˆCV=0.35ï¼‰ï¼Œå»ºè®®ç¨³å®šè¾“å‡ºèŠ‚å¥"
  ],
  "execution_insights": [
    "åˆå§‹æµé‡ä¼˜ç§€ï¼ˆ1h æ’­æ”¾ä¸ºåŸºå‡† 2.86xï¼‰ï¼ŒHook å¸å¼•åŠ›å¼º",
    "äº’åŠ¨ç‡ 5.94%ï¼Œé«˜äºåŸºå‡† 41%ï¼Œå†…å®¹ä»·å€¼æ„Ÿè·è®¤å¯",
    "å‘å¸ƒå»¶è¿Ÿ 32 åˆ†é’Ÿï¼Œä½†ä»åœ¨æœ€ä½³çª—å£æœŸï¼Œå½±å“æœ‰é™"
  ],
  "success_factors": [
    "è¶‹åŠ¿é€‰æ‹©ç²¾å‡†ï¼ˆä¸Šå‡å‹ + é«˜èµ›é“ç›¸å…³æ€§ï¼‰",
    "å†…å®¹è´¨é‡ä¼˜ç§€ï¼ˆHook å¼º + äº’åŠ¨æ·±åº¦é«˜ï¼‰",
    "æ‰§è¡Œåˆ°ä½åº¦è‰¯å¥½ï¼ˆ87 åˆ†ï¼Œè„šæœ¬éµå¾ª 89%ï¼‰"
  ],
  "improvement_suggestions": [
    "ä¸¥æ ¼æŒ‰æ¨èæ—¶é—´å‘å¸ƒï¼Œé¿å…å»¶è¿Ÿå½±å“åˆå§‹æµé‡",
    "æ ‡ç­¾ç¬¦åˆåº¦ä»… 75%ï¼Œå»ºè®®å®Œæ•´ä½¿ç”¨æ¨èæ ‡ç­¾",
    "æŒç»­å…³æ³¨ Skincare ç±»è¶‹åŠ¿ï¼Œè¯¥ç±»å‹ä¸ºä¼˜åŠ¿èµ›é“"
  ]
}}
```
"""
```

### 7.3 Few-Shot ç¤ºä¾‹

**ç¤ºä¾‹ 1ï¼šä¼˜ç§€æ•ˆæœæ¡ˆä¾‹**

```json
{
  "user_prompt": "ç»¼åˆè¯„åˆ† 82.5/100ï¼Œæ•ˆæœç­‰çº§ excellentï¼Œæµé‡ç›¸å¯¹ 2.94xï¼Œäº’åŠ¨ç›¸å¯¹ 1.41x...",
  "expected_output": {
    "trend_insights": [
      "è¶‹åŠ¿é¢„æµ‹å‡†ç¡®ç‡ 85%ï¼Œå…¥åœºæ—¶æœºè·å³°å€¼ 1.5hï¼Œæ—¶æœºæŠŠæ¡ä¼˜ç§€",
      "ä¸Šå‡å‹è¶‹åŠ¿å¤„äºå¿«é€Ÿå¢é•¿æœŸï¼Œæœªæ¥ 3-5 å¤©çƒ­åº¦æŒç»­",
      "è¯¥è¶‹åŠ¿å†å²æˆåŠŸç‡ 73%ï¼Œå±ä¼˜è´¨è¶‹åŠ¿ï¼Œå»ºè®®æŒç»­å…³æ³¨"
    ],
    "success_factors": [
      "è¶‹åŠ¿é€‰æ‹©ç²¾å‡†ï¼ˆä¸Šå‡å‹ + é«˜ç›¸å…³æ€§ï¼‰",
      "å†…å®¹è´¨é‡ä¼˜ç§€ï¼ˆHook å¼º + äº’åŠ¨æ·±ï¼‰",
      "æ‰§è¡Œåˆ°ä½åº¦ 87 åˆ†ï¼Œè„šæœ¬éµå¾ª 89%"
    ]
  }
}
```

**ç¤ºä¾‹ 2ï¼šè¾ƒå·®æ•ˆæœæ¡ˆä¾‹**

```json
{
  "user_prompt": "ç»¼åˆè¯„åˆ† 35.2/100ï¼Œæ•ˆæœç­‰çº§ poorï¼Œæµé‡ç›¸å¯¹ 0.6xï¼Œäº’åŠ¨ç›¸å¯¹ 0.5x...",
  "expected_output": {
    "trend_insights": [
      "è¶‹åŠ¿é¢„æµ‹åå·®è¾¾ 45%ï¼Œå®é™…çƒ­åº¦è¿œä½äºé¢„æœŸ",
      "å…¥åœºæ—¶é—´é”™è¿‡å³°å€¼ 18 å°æ—¶ï¼Œè¶‹åŠ¿å·²è¿›å…¥è¡°é€€æœŸ",
      "è¯¥è¶‹åŠ¿ä¸ºèŒèŠ½å‹ï¼ˆEmergingï¼‰ï¼Œé£é™©è¾ƒé«˜ï¼Œä¸é€‚åˆè¯¥è´¦å·"
    ],
    "success_factors": [
      "è¶‹åŠ¿é€‰æ‹©å¤±è¯¯ï¼ˆé”™è¿‡å³°å€¼ + è¶‹åŠ¿è´¨é‡ä½ï¼‰",
      "èµ›é“ä¸åŒ¹é…ï¼ˆç›¸å…³æ€§ä»… 42%ï¼‰",
      "å†…å®¹è´¨é‡ä¸è¶³ï¼ˆHook å¼±ï¼Œ1h æ’­æ”¾ä»…åŸºå‡† 0.4xï¼‰"
    ],
    "improvement_suggestions": [
      "é¿å…é€‰æ‹©èŒèŠ½å‹è¶‹åŠ¿ï¼Œä¼˜å…ˆé€‰æ‹©ä¸Šå‡å‹æˆ–å‘¨æœŸå‹",
      "èšç„¦ä¸»èµ›é“ç›¸å…³è¶‹åŠ¿ï¼ˆç›¸å…³æ€§ > 70%ï¼‰",
      "åŠ å¼º Hook è®¾è®¡ï¼Œå‰ 3 ç§’å¿…é¡»å¸å¼•çœ¼çƒ"
    ]
  }
}
```

---

## å…«ã€è¾“å‡ºç»“æœè§„èŒƒ

### 8.1 æ•°æ®åº“æŒä¹…åŒ–æ ¼å¼

**è¡¨ï¼šres_effect_attribution**

```sql
-- å®Œæ•´è®°å½•ç¤ºä¾‹
{
  "attribution_id": "uuid-abc123",
  "video_id": "7572198435487501598",
  "account_id": "ACC_001",
  "publish_date": "2026-02-01",
  
  -- æ•ˆæœè¯„ä¼°
  "effect_level": "excellent",
  "overall_score": 82.5,
  "traffic_score": 95.2,
  "engagement_score": 78.6,
  "growth_score": 68.3,
  "monetization_score": null,
  
  -- ä¸‰å› ç´ å½’å› åˆ†æ•°
  "trend_factor_score": 82.5,
  "user_factor_score": 75.3,
  "execution_factor_score": 85.7,
  
  -- è¯¦ç»†å½’å› æ•°æ®ï¼ˆJSONBï¼‰
  "trend_attribution": {...},  // è§ Tool T004 è¾“å‡º
  "user_attribution": {...},   // è§ Tool T005 è¾“å‡º
  "execution_attribution": {...},  // è§ Tool T006 è¾“å‡º
  
  -- æ´å¯Ÿä¸å»ºè®®
  "success_factors": [
    "è¶‹åŠ¿é€‰æ‹©ç²¾å‡†ï¼ˆä¸Šå‡å‹ + é«˜èµ›é“ç›¸å…³æ€§ï¼‰",
    "å†…å®¹è´¨é‡ä¼˜ç§€ï¼ˆHook å¼º + äº’åŠ¨æ·±åº¦é«˜ï¼‰",
    "æ‰§è¡Œåˆ°ä½åº¦è‰¯å¥½ï¼ˆ87 åˆ†ï¼Œè„šæœ¬éµå¾ª 89%ï¼‰"
  ],
  "improvement_suggestions": [
    "ä¸¥æ ¼æŒ‰æ¨èæ—¶é—´å‘å¸ƒï¼Œé¿å…å»¶è¿Ÿå½±å“åˆå§‹æµé‡",
    "æ ‡ç­¾ç¬¦åˆåº¦ä»… 75%ï¼Œå»ºè®®å®Œæ•´ä½¿ç”¨æ¨èæ ‡ç­¾",
    "æŒç»­å…³æ³¨ Skincare ç±»è¶‹åŠ¿ï¼Œè¯¥ç±»å‹ä¸ºä¼˜åŠ¿èµ›é“"
  ],
  
  -- å­¦ä¹ ä¿¡å·
  "learning_signals": {...},  // è§ Tool T008 è¾“å‡º
  
  -- å…ƒæ•°æ®
  "data_completeness": 0.95,
  "analysis_confidence": 0.88,
  "created_at": "2026-02-04T14:35:23Z",
  "updated_at": "2026-02-04T14:35:23Z"
}
```

### 8.2 API å“åº”æ ¼å¼

**GET /api/v1/attribution/{attribution_id}**

```json
{
  "status": "success",
  "data": {
    "attribution_id": "uuid-abc123",
    "video_id": "7572198435487501598",
    "account_id": "ACC_001",
    "analysis_timestamp": "2026-02-04T14:35:23Z",
    
    "summary": {
      "effect_level": "excellent",
      "overall_score": 82.5,
      "headline": "å†…å®¹æ•ˆæœä¼˜ç§€ï¼Œæµé‡è¡¨ç°è¶…åŸºå‡† 194%"
    },
    
    "effect_evaluation": {
      "overall_score": 82.5,
      "dimensions": {
        "traffic": {"score": 95.2, "relative": 2.94},
        "engagement": {"score": 78.6, "relative": 1.41},
        "growth": {"score": 68.3, "relative": 1.1},
        "monetization": null
      }
    },
    
    "attribution_analysis": {
      "trend": {
        "score": 82.5,
        "weight": 0.4,
        "contribution": 33.0,
        "insights": [
          "è¶‹åŠ¿é¢„æµ‹å‡†ç¡®ç‡ 85%ï¼Œå…¥åœºæ—¶æœºæŠŠæ¡è‰¯å¥½",
          "ä¸Šå‡å‹è¶‹åŠ¿å¤„äºå¿«é€Ÿå¢é•¿æœŸï¼Œæœªæ¥ 3-5 å¤©çƒ­åº¦æŒç»­",
          "è¯¥è¶‹åŠ¿å†å²æˆåŠŸç‡ 73%ï¼Œå±ä¼˜è´¨è¶‹åŠ¿"
        ]
      },
      "user": {
        "score": 75.3,
        "weight": 0.25,
        "contribution": 18.83,
        "insights": [
          "è´¦å·èƒ½åŠ›ä¸å†…å®¹éš¾åº¦åŒ¹é…è‰¯å¥½ï¼Œå­˜åœ¨è½»å¾®æŒ‘æˆ˜",
          "èµ›é“ç›¸å…³æ€§ 88/100ï¼Œé«˜åº¦å¥‘åˆ",
          "è¿‘æœŸè¡¨ç°æ³¢åŠ¨å¤§ï¼Œå»ºè®®ç¨³å®šè¾“å‡ºèŠ‚å¥"
        ]
      },
      "execution": {
        "score": 85.7,
        "weight": 0.35,
        "contribution": 30.0,
        "insights": [
          "åˆå§‹æµé‡ä¼˜ç§€ï¼ŒHook å¸å¼•åŠ›å¼º",
          "äº’åŠ¨ç‡é«˜äºåŸºå‡† 41%ï¼Œå†…å®¹ä»·å€¼æ„Ÿè·è®¤å¯",
          "å‘å¸ƒå»¶è¿Ÿ 32 åˆ†é’Ÿï¼Œä½†å½±å“æœ‰é™"
        ]
      }
    },
    
    "actionable_output": {
      "success_factors": [
        "è¶‹åŠ¿é€‰æ‹©ç²¾å‡†ï¼ˆä¸Šå‡å‹ + é«˜ç›¸å…³æ€§ï¼‰",
        "å†…å®¹è´¨é‡ä¼˜ç§€ï¼ˆHook å¼º + äº’åŠ¨æ·±ï¼‰",
        "æ‰§è¡Œåˆ°ä½åº¦è‰¯å¥½ï¼ˆ87 åˆ†ï¼‰"
      ],
      "improvement_suggestions": [
        "ä¸¥æ ¼æŒ‰æ¨èæ—¶é—´å‘å¸ƒ",
        "å®Œæ•´ä½¿ç”¨æ¨èæ ‡ç­¾",
        "æŒç»­å…³æ³¨ Skincare ç±»è¶‹åŠ¿"
      ],
      "next_steps": [
        "æŸ¥çœ‹åŒç±»å‹æˆåŠŸæ¡ˆä¾‹",
        "è°ƒæ•´ä¸‹æ¬¡å‘å¸ƒæ—¶é—´ç­–ç•¥",
        "ä¼˜åŒ–æ ‡ç­¾ä½¿ç”¨è§„èŒƒ"
      ]
    },
    
    "metadata": {
      "data_completeness": 0.95,
      "analysis_confidence": 0.88,
      "tools_used": ["T001", "T002", "T003", "T004", "T005", "T006", "T007", "T008"],
      "processing_time_ms": 3523
    }
  }
}
```

### 8.3 åˆ›ä½œè€…å‹å¥½æŠ¥å‘Šï¼ˆMarkdownï¼‰

```markdown
# è§†é¢‘æ•ˆæœå½’å› åˆ†ææŠ¥å‘Š

**è§†é¢‘ ID**: 7572198435487501598  
**åˆ†ææ—¶é—´**: 2026-02-04 14:35:23  
**ç»¼åˆè¯„åˆ†**: 82.5/100 â­â­â­â­  
**æ•ˆæœç­‰çº§**: ä¼˜ç§€ (Excellent)

---

## ğŸ“Š æ•ˆæœè¡¨ç°æ¦‚è§ˆ

| ç»´åº¦ | è¯„åˆ† | ç›¸å¯¹è¡¨ç° | è¯´æ˜ |
|------|------|----------|------|
| æµé‡æ•ˆæœ | 95.2/100 | 2.94x åŸºå‡† | æ’­æ”¾é‡ 25,000ï¼Œè¿œè¶… 30 å¤©å¹³å‡ 8,500 |
| äº’åŠ¨æ•ˆæœ | 78.6/100 | 1.41x åŸºå‡† | äº’åŠ¨ç‡ 5.94%ï¼Œé«˜äºåŸºå‡† 4.2% |
| æ¶¨ç²‰æ•ˆæœ | 68.3/100 | 1.1x åŸºå‡† | 48h æ¶¨ç²‰ 23 äººï¼Œè½¬åŒ–ç‡ç•¥é«˜ |
| å˜ç°æ•ˆæœ | - | - | æš‚æ— æ•°æ® |

---

## ğŸ” å½’å› åˆ†æ

### è¶‹åŠ¿å› ç´  (è´¡çŒ®åº¦ 33.0%)
**è¯„åˆ†**: 82.5/100

**å…³é”®æ´å¯Ÿ**:
1. è¶‹åŠ¿é¢„æµ‹å‡†ç¡®ç‡ 85%ï¼Œå…¥åœºæ—¶æœºè·å³°å€¼ä»… 1.5 å°æ—¶ï¼ŒæŠŠæ¡ä¼˜ç§€
2. è¯¥è¶‹åŠ¿å±ä¸Šå‡å‹ï¼ˆRisingï¼‰ï¼Œå½“å‰å¤„äºå¿«é€Ÿå¢é•¿æœŸï¼Œæœªæ¥ 3-5 å¤©ä»æœ‰çƒ­åº¦
3. Skincare Routines è¶‹åŠ¿å†å²æˆåŠŸç‡ 73%ï¼Œå±ä¼˜è´¨è¶‹åŠ¿ï¼Œå»ºè®®æŒç»­å…³æ³¨è¯¥ç±»å‹

### ç”¨æˆ·å› ç´  (è´¡çŒ®åº¦ 18.83%)
**è¯„åˆ†**: 75.3/100

**å…³é”®æ´å¯Ÿ**:
1. è´¦å·èƒ½åŠ›ï¼ˆL4.2ï¼‰ä¸å†…å®¹éš¾åº¦ï¼ˆMediumï¼‰åŒ¹é…è‰¯å¥½ï¼Œä½†å­˜åœ¨è½»å¾®æŒ‘æˆ˜
2. èµ›é“ç›¸å…³æ€§è¯„åˆ† 88/100ï¼Œbeauty ä¸»èµ›é“ä¸ skincare è¶‹åŠ¿é«˜åº¦å¥‘åˆ
3. è¿‘æœŸè¡¨ç°æ³¢åŠ¨è¾ƒå¤§ï¼ˆå˜å¼‚ç³»æ•° 0.35ï¼‰ï¼Œå»ºè®®ç¨³å®šå†…å®¹è¾“å‡ºèŠ‚å¥

### æ‰§è¡Œå› ç´  (è´¡çŒ®åº¦ 30.0%)
**è¯„åˆ†**: 85.7/100

**å…³é”®æ´å¯Ÿ**:
1. åˆå§‹æµé‡è¡¨ç°ä¼˜ç§€ï¼ˆ1 å°æ—¶æ’­æ”¾é‡ä¸ºåŸºå‡†çš„ 2.86 å€ï¼‰ï¼ŒHook å¸å¼•åŠ›å¼º
2. äº’åŠ¨ç‡è¾¾ 5.94%ï¼Œé«˜äºåŸºå‡† 41%ï¼Œå†…å®¹æ·±åº¦å’Œä»·å€¼æ„Ÿè·å¾—è®¤å¯
3. å‘å¸ƒæ—¶é—´å»¶è¿Ÿ 32 åˆ†é’Ÿï¼Œä½†ä»åœ¨æœ€ä½³çª—å£æœŸå†…ï¼Œå¯¹æ•ˆæœå½±å“æœ‰é™

---

## âœ… æˆåŠŸå› ç´ 

1. **è¶‹åŠ¿é€‰æ‹©ç²¾å‡†**ï¼šä¸Šå‡å‹è¶‹åŠ¿ + é«˜èµ›é“ç›¸å…³æ€§ï¼ˆ88%ï¼‰
2. **å†…å®¹è´¨é‡ä¼˜ç§€**ï¼šHook å¸å¼•åŠ›å¼º + äº’åŠ¨æ·±åº¦é«˜
3. **æ‰§è¡Œåˆ°ä½åº¦è‰¯å¥½**ï¼š87 åˆ†ï¼Œè„šæœ¬éµå¾ªåº¦ 89%

---

## ğŸ’¡ æ”¹è¿›å»ºè®®

1. **ä¸¥æ ¼æŒ‰æ¨èæ—¶é—´å‘å¸ƒ**  
   æœ¬æ¬¡å»¶è¿Ÿ 32 åˆ†é’Ÿè™½å½±å“æœ‰é™ï¼Œä½†å»ºè®®æœªæ¥ä¸¥æ ¼æŒ‰æ¨èæ—¶é—´æ‰§è¡Œï¼Œä»¥æœ€å¤§åŒ–åˆå§‹æµé‡

2. **å®Œæ•´ä½¿ç”¨æ¨èæ ‡ç­¾**  
   æ ‡ç­¾ç¬¦åˆåº¦ä»… 75%ï¼Œå»ºè®®å®Œæ•´ä½¿ç”¨ç³»ç»Ÿæ¨èçš„æ ‡ç­¾ç»„åˆï¼Œæå‡å†…å®¹åˆ†å‘ç²¾å‡†åº¦

3. **æŒç»­å…³æ³¨ Skincare ç±»è¶‹åŠ¿**  
   è¯¥ç±»å‹è¶‹åŠ¿ä¸è´¦å·èµ›é“é«˜åº¦åŒ¹é…ï¼Œå»ºè®®æŒç»­ç›‘æµ‹å¹¶ä¼˜å…ˆé€‰æ‹©ç›¸å…³è¶‹åŠ¿

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

- [ ] æŸ¥çœ‹åŒç±»å‹æˆåŠŸæ¡ˆä¾‹ï¼Œå­¦ä¹ ä¼˜ç§€è„šæœ¬ç»“æ„
- [ ] è°ƒæ•´ä¸‹æ¬¡å‘å¸ƒæ—¶é—´ç­–ç•¥ï¼Œè®¾ç½®æå‰æé†’
- [ ] ä¼˜åŒ–æ ‡ç­¾ä½¿ç”¨è§„èŒƒï¼Œå»ºç«‹æ ‡ç­¾åº“æ¨¡æ¿

---

**æ•°æ®å®Œæ•´åº¦**: 95%  
**åˆ†æç½®ä¿¡åº¦**: 88%  
**å¤„ç†è€—æ—¶**: 3.5 ç§’
```

---

## ä¹ã€æŠ€æœ¯å®ç°è¦æ±‚

### 9.1 æŠ€æœ¯æ ˆè¦æ±‚

| æŠ€æœ¯ç»„ä»¶ | è¦æ±‚ç‰ˆæœ¬ | ç”¨é€” |
|---------|---------|------|
| **Python** | 3.11+ | æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ |
| **FastAPI** | 0.109+ | API æœåŠ¡æ¡†æ¶ |
| **PostgreSQL** | 15+ | ä¸»æ•°æ®åº“ |
| **Redis** | 7+ | ç¼“å­˜ + ä»»åŠ¡é˜Ÿåˆ— |
| **Celery** | 5.3+ | å¼‚æ­¥ä»»åŠ¡è°ƒåº¦ |
| **OpenAI SDK** | 1.10+ | GPT-4o è°ƒç”¨ |
| **httpx** | 0.26+ | Tikfly API è°ƒç”¨ |
| **SQLAlchemy** | 2.0+ | ORM æ¡†æ¶ |
| **Pydantic** | 2.5+ | æ•°æ®éªŒè¯ |

### 9.2 æ€§èƒ½è¦æ±‚

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | ç›‘æ§æ–¹å¼ |
|------|--------|---------|
| **å•æ¬¡å½’å› è€—æ—¶ (P95)** | < 30 ç§’ | Prometheus + Grafana |
| **æ‰¹é‡åˆ†æåå** | 50 è§†é¢‘/å°æ—¶ | Celery ç›‘æ§ |
| **LLM è°ƒç”¨æˆåŠŸç‡** | > 98% | API æ—¥å¿—ç»Ÿè®¡ |
| **æ•°æ®åº“æŸ¥è¯¢ (P99)** | < 200ms | pg_stat_statements |
| **ç¼“å­˜å‘½ä¸­ç‡** | > 80% | Redis INFO stats |

### 9.3 é”™è¯¯å¤„ç†è¦æ±‚

**é”™è¯¯åˆ†çº§**:
- **P0 é”™è¯¯**ï¼šæ•°æ®ä¸¢å¤±ã€å½’å› æµç¨‹ä¸­æ–­ â†’ ç«‹å³å‘Šè­¦ + äººå·¥ä»‹å…¥
- **P1 é”™è¯¯**ï¼šéƒ¨åˆ†å·¥å…·å¤±è´¥ã€æ•°æ®ä¸å®Œæ•´ â†’ é™ä½ç½®ä¿¡åº¦ç»§ç»­ + å¼‚æ­¥å‘Šè­¦
- **P2 é”™è¯¯**ï¼šç¼“å­˜å¤±æ•ˆã€éå…³é”®æ•°æ®ç¼ºå¤± â†’ ä½¿ç”¨é»˜è®¤å€¼ + è®°å½•æ—¥å¿—

**é‡è¯•ç­–ç•¥**:
```python
# LLM è°ƒç”¨é‡è¯•
@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=4, max=60),
    retry=retry_if_exception_type(OpenAIError)
)
def call_llm(prompt):
    ...

# Tikfly API è°ƒç”¨é‡è¯•
@retry(
    stop=stop_after_attempt(3),
    wait=wait_fixed(60),  # Rate limit ç­‰å¾…
    retry=retry_if_exception_type(RateLimitError)
)
def fetch_tikfly_api(endpoint, params):
    ...
```

### 9.4 æ•°æ®åº“ç´¢å¼•è¦æ±‚

```sql
-- res_effect_attribution è¡¨ç´¢å¼•
CREATE INDEX idx_attribution_video ON res_effect_attribution(video_id);
CREATE INDEX idx_attribution_account_date ON res_effect_attribution(account_id, publish_date DESC);
CREATE INDEX idx_attribution_effect_level ON res_effect_attribution(effect_level);
CREATE INDEX idx_attribution_score ON res_effect_attribution(overall_score DESC);
CREATE INDEX idx_attribution_created ON res_effect_attribution(created_at DESC);

-- user_baseline_metrics è¡¨ç´¢å¼•
CREATE INDEX idx_baseline_account ON user_baseline_metrics(account_id);
CREATE INDEX idx_baseline_updated ON user_baseline_metrics(last_updated_at DESC);

-- learning_signal_history è¡¨ç´¢å¼•
CREATE INDEX idx_signal_account_type ON learning_signal_history(account_id, signal_type, created_at DESC);
CREATE INDEX idx_signal_attribution ON learning_signal_history(attribution_id);
```

### 9.5 æ—¥å¿—è§„èŒƒ

```python
# æ ‡å‡†æ—¥å¿—æ ¼å¼
logger.info(
    "Attribution completed",
    extra={
        "attribution_id": attribution_id,
        "video_id": video_id,
        "account_id": account_id,
        "overall_score": overall_score,
        "effect_level": effect_level,
        "processing_time_ms": processing_time,
        "tools_executed": ["T001", "T002", ...],
        "llm_tokens": {"prompt": 1523, "completion": 487}
    }
)
```

---

## åã€æµ‹è¯•éªŒæ”¶æ ‡å‡†

### 10.1 å•å…ƒæµ‹è¯•è¦†ç›–ç‡

| æ¨¡å— | è¦†ç›–ç‡è¦æ±‚ | å…³é”®æµ‹è¯•åœºæ™¯ |
|------|-----------|-------------|
| **evaluator.py** | > 90% | ç›¸å¯¹è¯„åˆ†æ˜ å°„ã€ç­‰çº§æ˜ å°„ã€è¾¹ç•Œå€¼ |
| **analyzer.py** | > 85% | ä¸‰å› ç´ è®¡ç®—é€»è¾‘ã€å¼‚å¸¸æ•°æ®å¤„ç† |
| **learning.py** | > 80% | å­¦ä¹ ä¿¡å·æå–è§„åˆ™ã€ç³»æ•°æ›´æ–° |
| **tikfly_client.py** | > 75% | API è°ƒç”¨ã€åˆ†é¡µé€»è¾‘ã€é”™è¯¯é‡è¯• |

### 10.2 é›†æˆæµ‹è¯•åœºæ™¯

| æµ‹è¯•åœºæ™¯ | è¾“å…¥æ•°æ® | é¢„æœŸè¾“å‡º | é€šè¿‡æ ‡å‡† |
|---------|---------|---------|---------|
| **ä¼˜ç§€æ•ˆæœå½’å› ** | æ’­æ”¾ 3x åŸºå‡†ï¼Œäº’åŠ¨ 1.5x | overall_score > 85, effect_level="excellent" | âœ… |
| **è¾ƒå·®æ•ˆæœå½’å› ** | æ’­æ”¾ 0.6x åŸºå‡†ï¼Œäº’åŠ¨ 0.5x | overall_score < 40, effect_level="poor" | âœ… |
| **æ•°æ®ç¼ºå¤±åœºæ™¯** | ç¼ºå¤± 40% å­—æ®µ | data_completeness < 0.7, ç»§ç»­åˆ†æ | âœ… |
| **LLM è°ƒç”¨å¤±è´¥** | Mock LLM è¶…æ—¶ | é‡è¯• 3 æ¬¡åä½¿ç”¨é»˜è®¤æ´å¯Ÿ | âœ… |
| **Tikfly API é™æµ** | Mock 429 å“åº” | ç­‰å¾… 60s åé‡è¯•æˆåŠŸ | âœ… |

### 10.3 ç«¯åˆ°ç«¯æµ‹è¯•

```python
# æµ‹è¯•ç”¨ä¾‹ï¼šå®Œæ•´å½’å› æµç¨‹
async def test_end_to_end_attribution():
    # 1. è§¦å‘å½’å› åˆ†æ
    response = await client.post(
        "/api/v1/attribution/analyze",
        json={
            "video_id": "7572198435487501598",
            "account_id": "ACC_TEST_001",
            "priority": "P1"
        }
    )
    assert response.status_code == 202
    attribution_id = response.json()["attribution_id"]
    
    # 2. ç­‰å¾…åˆ†æå®Œæˆï¼ˆå®é™…æµ‹è¯•ä½¿ç”¨ mockï¼‰
    await asyncio.sleep(5)
    
    # 3. è·å–ç»“æœ
    response = await client.get(f"/api/v1/attribution/result/{attribution_id}")
    assert response.status_code == 200
    
    result = response.json()
    assert result["data"]["video_id"] == "7572198435487501598"
    assert 0 <= result["data"]["effect_evaluation"]["overall_score"] <= 100
    assert "attribution_analysis" in result["data"]
    assert len(result["data"]["actionable_output"]["success_factors"]) == 3
    assert len(result["data"]["actionable_output"]["improvement_suggestions"]) == 3
```

### 10.4 æ€§èƒ½å‹æµ‹æ ‡å‡†

```bash
# ä½¿ç”¨ Locust è¿›è¡Œå‹æµ‹
# ç›®æ ‡ï¼šæ¨¡æ‹Ÿ 100 ä¸ªè´¦å·åŒæ—¶è§¦å‘å½’å› 
locust -f tests/load_test.py --users 100 --spawn-rate 10 --host http://localhost:8000

# é€šè¿‡æ ‡å‡†ï¼š
# - P95 å“åº”æ—¶é—´ < 30 ç§’
# - æˆåŠŸç‡ > 99%
# - æ— å†…å­˜æ³„æ¼
```

---

## é™„å½•

### A. æ•°æ®åº“å®Œæ•´ Schema

```sql
-- res_effect_attribution è¡¨ï¼ˆå®Œæ•´ç‰ˆï¼‰
CREATE TABLE res_effect_attribution (
  attribution_id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  video_id VARCHAR(64) NOT NULL,
  account_id VARCHAR(64) NOT NULL,
  publish_date DATE NOT NULL,
  
  -- æ•ˆæœè¯„ä¼°
  effect_level VARCHAR(20) NOT NULL CHECK (effect_level IN ('viral', 'excellent', 'good', 'average', 'poor')),
  effect_score DECIMAL(5,2) NOT NULL CHECK (effect_score >= 0 AND effect_score <= 100),
  overall_score DECIMAL(5,2) NOT NULL CHECK (overall_score >= 0 AND overall_score <= 100),
  traffic_score DECIMAL(5,2) NOT NULL CHECK (traffic_score >= 0 AND traffic_score <= 100),
  engagement_score DECIMAL(5,2) NOT NULL CHECK (engagement_score >= 0 AND engagement_score <= 100),
  growth_score DECIMAL(5,2) NOT NULL CHECK (growth_score >= 0 AND growth_score <= 100),
  monetization_score DECIMAL(5,2) CHECK (monetization_score >= 0 AND monetization_score <= 100),
  
  -- ä¸‰å› ç´ å½’å› åˆ†æ•°
  trend_factor_score DECIMAL(5,2) NOT NULL CHECK (trend_factor_score >= 0 AND trend_factor_score <= 100),
  user_factor_score DECIMAL(5,2) NOT NULL CHECK (user_factor_score >= 0 AND user_factor_score <= 100),
  execution_factor_score DECIMAL(5,2) NOT NULL CHECK (execution_factor_score >= 0 AND execution_factor_score <= 100),
  
  -- è¯¦ç»†å½’å› æ•°æ® (JSONB)
  trend_attribution JSONB NOT NULL,
  user_attribution JSONB NOT NULL,
  execution_attribution JSONB NOT NULL,
  
  -- æ´å¯Ÿä¸å»ºè®®
  success_factors JSONB NOT NULL,
  improvement_suggestions JSONB NOT NULL,
  
  -- å­¦ä¹ ä¿¡å·
  learning_signals JSONB NOT NULL,
  
  -- å…ƒæ•°æ®
  data_completeness DECIMAL(3,2) NOT NULL CHECK (data_completeness >= 0 AND data_completeness <= 1),
  analysis_confidence DECIMAL(3,2) NOT NULL CHECK (analysis_confidence >= 0 AND analysis_confidence <= 1),
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  -- çº¦æŸ
  CONSTRAINT unique_video_attribution UNIQUE (video_id)
);

-- ç”¨æˆ·åŸºå‡†æ•°æ®è¡¨
CREATE TABLE user_baseline_metrics (
  account_id VARCHAR(64) PRIMARY KEY,
  
  -- 30 å¤©æ»šåŠ¨åŸºå‡†
  avg_views_30d INTEGER NOT NULL,
  avg_engagement_rate_30d DECIMAL(6,5) NOT NULL,
  avg_follower_conversion_30d DECIMAL(6,5) NOT NULL,
  avg_views_1h_30d INTEGER NOT NULL,
  avg_gmv_per_1k_views_30d DECIMAL(10,2),
  
  -- è¶‹åŠ¿ç±»å‹è¡¨ç°ç³»æ•°
  trend_coefficients JSONB NOT NULL DEFAULT '{}',
  
  -- å†…å®¹è§’åº¦è¡¨ç°ç³»æ•°
  angle_coefficients JSONB NOT NULL DEFAULT '{}',
  
  -- æ‰§è¡Œèƒ½åŠ›è¾¹ç•Œ
  capability_boundary JSONB NOT NULL DEFAULT '{"current_level": 5.0, "max_complexity": 10.0}',
  
  -- æ›´æ–°æ—¶é—´
  last_updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  calculation_date_range TSRANGE NOT NULL
);

-- å­¦ä¹ ä¿¡å·å†å²è¡¨
CREATE TABLE learning_signal_history (
  signal_id SERIAL PRIMARY KEY,
  attribution_id UUID REFERENCES res_effect_attribution(attribution_id) ON DELETE CASCADE,
  account_id VARCHAR(64) NOT NULL,
  
  signal_type VARCHAR(50) NOT NULL,
  signal_content JSONB NOT NULL,
  applied_at TIMESTAMP,
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ¨èè®°å½•è¡¨ï¼ˆå‡è®¾å·²å­˜åœ¨ï¼‰
CREATE TABLE recommendation_records (
  recommendation_id VARCHAR(64) PRIMARY KEY,
  video_id VARCHAR(64) NOT NULL,
  account_id VARCHAR(64) NOT NULL,
  
  trend_info JSONB NOT NULL,
  recommended_strategy JSONB NOT NULL,
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æ‰§è¡Œè®°å½•è¡¨ï¼ˆå‡è®¾å·²å­˜åœ¨ï¼‰
CREATE TABLE execution_records (
  execution_id VARCHAR(64) PRIMARY KEY,
  video_id VARCHAR(64) NOT NULL,
  recommendation_id VARCHAR(64) REFERENCES recommendation_records(recommendation_id),
  
  planned_content JSONB NOT NULL,
  actual_execution JSONB NOT NULL,
  compliance_scores JSONB NOT NULL,
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### B. API ç«¯ç‚¹å®Œæ•´åˆ—è¡¨

```yaml
openapi: 3.0.0
info:
  title: Attribution Agent API
  version: 1.0.0

paths:
  /api/v1/attribution/analyze:
    post:
      summary: è§¦å‘å½’å› åˆ†æ
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required: [video_id, account_id]
              properties:
                video_id:
                  type: string
                account_id:
                  type: string
                priority:
                  type: string
                  enum: [P0, P1, P2]
                  default: P1
      responses:
        202:
          description: ä»»åŠ¡å·²æ¥å—
          content:
            application/json:
              schema:
                type: object
                properties:
                  attribution_id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum: [pending, processing]
                  estimated_completion_time:
                    type: string
                    format: date-time

  /api/v1/attribution/result/{attribution_id}:
    get:
      summary: è·å–å½’å› ç»“æœ
      parameters:
        - name: attribution_id
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        200:
          description: å½’å› ç»“æœ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AttributionResult'
        202:
          description: åˆ†æä»åœ¨è¿›è¡Œä¸­
        404:
          description: ç»“æœä¸å­˜åœ¨

  /api/v1/attribution/batch:
    post:
      summary: æ‰¹é‡è§¦å‘å½’å› 
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                video_ids:
                  type: array
                  items:
                    type: string
                  maxItems: 50
                account_id:
                  type: string
      responses:
        202:
          description: æ‰¹é‡ä»»åŠ¡å·²æ¥å—

components:
  schemas:
    AttributionResult:
      type: object
      properties:
        attribution_id:
          type: string
        video_id:
          type: string
        effect_evaluation:
          type: object
        attribution_analysis:
          type: object
        actionable_output:
          type: object
        metadata:
          type: object
```

---

**æ–‡æ¡£ç»“æŸã€‚æœ¬ PRD ä¸¥æ ¼æŒ‰ç…§è´µå¸äº¤ä»˜æ ‡å‡†ç¼–å†™ï¼Œé¢—ç²’åº¦è¾¾åˆ°æŠ€æœ¯å¯ç›´æ¥å®ç°çº§åˆ«ã€‚å¦‚éœ€è°ƒæ•´ä»»ä½•æ¨¡å—ï¼Œè¯·æ˜ç¡®æŒ‡å‡ºã€‚**